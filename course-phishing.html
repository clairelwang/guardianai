<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Email & Text Phishing - Guardian Shield</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#0f172a;
      --muted:#64748b;
      --line:#e5e7eb;
      --bg:#f8fafc;
      --card:#ffffff;
      --shadow:0 14px 30px rgba(15,23,42,.06);
      --radius:18px;

      --red:#ef4444;
      --red-100:#fee2e2;
      --blue:#2563eb;
      --blue-100:#eff6ff;
      --green:#22c55e;
      --green-100:#dcfce7;
      --amber:#f59e0b;
      --amber-100:#fef3c7;
      --tab:#f1f5f9;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--ink);
    }

    .container{
      width:min(980px, calc(100% - 56px));
      margin:0 auto;
      padding:44px 0 80px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      margin-bottom:18px;
    }
    .back{
      display:inline-flex;
      align-items:center;
      gap:10px;
      color:#334155;
      text-decoration:none;
      font-weight:800;
      font-size:13px;
    }
    .back:hover{ text-decoration:underline; }

    .header{
      display:flex;
      align-items:flex-start;
      gap:14px;
      margin-bottom:12px;
    }
    .icon{
      width:44px;
      height:44px;
      border-radius:14px;
      background:var(--red);
      display:grid;
      place-items:center;
      color:white;
      flex:0 0 auto;
    }
    .icon svg{ width:22px; height:22px; }

    .titlewrap h1{
      margin:0;
      font-size:22px;
      font-weight:950;
      letter-spacing:-.02em;
      line-height:1.15;
    }
    .titlewrap .sub{
      margin-top:4px;
      color:var(--muted);
      font-weight:750;
      font-size:13px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      border:1px solid rgba(15,23,42,.08);
      background:#f1f5f9;
      color:#0f172a;
      white-space:nowrap;
    }
    .chip.pass{ background:var(--green-100); color:#166534; border-color:rgba(22,101,52,.15); }
    .chip.fail{ background:var(--red-100); color:#991b1b; border-color:rgba(153,27,27,.18); }
    .chip.warn{ background:var(--amber-100); color:#92400e; border-color:rgba(146,64,14,.18); }

    .progress{ margin:14px 0 18px; }
    .bar{
      height:8px;
      border-radius:999px;
      overflow:hidden;
      background:#e5e7eb;
    }
    .fill{
      height:100%;
      width:25%;
      background:#0f172a;
      transition: width .18s ease;
    }

    .tabs{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin:12px 0 18px;
    }
    .tab{
      border:none;
      background:var(--tab);
      color:#334155;
      font-weight:900;
      font-size:13px;
      padding:10px 14px;
      border-radius:999px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition: filter .12s ease, transform .12s ease;
    }
    .tab:hover{ filter:brightness(.98); transform: translateY(-1px); }
    .tab.active{ background:var(--red); color:white; }
    .tab.done{ background:var(--green-100); color:#166534; }

    .check{
      width:16px; height:16px;
      display:inline-grid;
      place-items:center;
      border-radius:999px;
      background:rgba(34,197,94,.18);
    }
    .tab:not(.done) .check{ display:none; }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:22px;
    }
    .card h2{
      margin:0 0 10px;
      font-size:20px;
      font-weight:950;
      letter-spacing:-.01em;
    }
    .card p{
      margin:0 0 12px;
      color:#334155;
      font-weight:650;
      line-height:1.75;
      font-size:14px;
    }
    .card h3{
      margin:18px 0 10px;
      font-size:14px;
      font-weight:950;
      letter-spacing:-.01em;
    }
    .card ul{
      margin:8px 0 0 18px;
      padding:0;
      color:#334155;
      font-weight:650;
      line-height:1.8;
      font-size:14px;
    }
    .card li{ margin:8px 0; }

    .callout{
      margin-top:14px;
      border:1px solid #e2e8f0;
      background:#f8fafc;
      border-radius:16px;
      padding:12px 14px;
      font-size:13px;
      color:#334155;
      font-weight:750;
      line-height:1.7;
    }
    .callout strong{ color:#0f172a; }

    /* fake message examples */
    .examples{
      margin-top:14px;
      display:grid;
      gap:12px;
    }
    .msg{
      border:1px solid #e2e8f0;
      background:white;
      border-radius:16px;
      padding:12px 14px;
    }
    .msg .hdr{
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      font-size:12px;
      font-weight:900;
      color:#0f172a;
      margin-bottom:6px;
    }
    .msg .hdr span{
      color:#64748b;
      font-weight:900;
    }
    .msg .body{
      font-size:13px;
      font-weight:650;
      color:#334155;
      line-height:1.65;
    }
    .pillmini{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      border:1px solid rgba(15,23,42,.08);
      background:#f1f5f9;
      color:#0f172a;
      white-space:nowrap;
    }
    .pillmini.bad{ background:var(--red-100); color:#991b1b; border-color:rgba(153,27,27,.18); }
    .pillmini.good{ background:var(--green-100); color:#166534; border-color:rgba(22,101,52,.15); }

    /* quiz */
    .quiz{
      margin-top:18px;
      border:1px solid #ffe4e6;
      background:#fff5f6;
      border-radius:16px;
      padding:14px;
    }
    .quizHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .quizTitle{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:950;
      color:#9f1239;
      font-size:13px;
    }
    .quizTitle .dot{
      width:28px; height:28px;
      border-radius:10px;
      background:var(--red);
      color:white;
      display:grid;
      place-items:center;
      flex:0 0 auto;
      font-weight:950;
    }
    .quizNote{
      font-size:12px;
      font-weight:850;
      color:#334155;
      background:white;
      border:1px solid #ffe4e6;
      padding:6px 10px;
      border-radius:999px;
      white-space:nowrap;
    }

    .q{
      border-top:1px solid rgba(159,18,57,.12);
      padding-top:12px;
      margin-top:12px;
    }
    .q:first-of-type{
      border-top:none;
      padding-top:0;
      margin-top:0;
    }
    .qText{
      font-weight:900;
      color:#0f172a;
      font-size:13px;
      margin:0 0 10px;
      line-height:1.5;
    }
    .opt{
      display:flex;
      align-items:flex-start;
      gap:10px;
      padding:10px 10px;
      border-radius:12px;
      background:rgba(255,255,255,.85);
      border:1px solid rgba(255,228,230,.95);
      margin-bottom:10px;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease;
    }
    .opt:hover{ transform: translateY(-1px); filter:brightness(.99); }
    .opt input{ margin-top:3px; }
    .opt span{
      font-size:13px;
      font-weight:750;
      color:#0f172a;
      line-height:1.45;
    }

    .quizActions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .btn{
      border:none;
      cursor:pointer;
      padding:10px 12px;
      border-radius:12px;
      font-weight:950;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:10px;
    }
    .btn.primary{ background:#0f172a; color:white; }
    .btn.secondary{ background:#f3f4f6; color:#0f172a; border:1px solid #e5e7eb; }
    .btn:disabled{ opacity:.5; cursor:not-allowed; }

    .result{
      margin-top:12px;
      background:white;
      border:1px solid rgba(255,228,230,.95);
      border-radius:12px;
      padding:10px 12px;
      font-weight:900;
      font-size:13px;
      display:none;
    }
    .result.ok{ border-color:rgba(22,101,52,.18); background:#f0fdf4; color:#166534; }
    .result.bad{ border-color:rgba(153,27,27,.18); background:#fef2f2; color:#991b1b; }

    .explain{
      margin-top:10px;
      display:none;
      font-weight:650;
      color:#334155;
      font-size:13px;
      line-height:1.65;
    }
    .explain ul{ margin:8px 0 0 18px; }
    .explain li{ margin:6px 0; }

    /* assistant (non-functional) */
    .assistant{
      margin-top:16px;
      border:1px solid #ffe4e6;
      background:#fff5f6;
      border-radius:16px;
      padding:14px;
    }
    .assistantHead{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:950;
      color:#9f1239;
      margin-bottom:10px;
      font-size:13px;
    }
    .assistantHead .badge{
      width:28px; height:28px;
      border-radius:10px;
      background:var(--red);
      color:white;
      display:grid;
      place-items:center;
      flex:0 0 auto;
      font-weight:950;
    }
    .assistantBtn{
      border:1px solid #ffe4e6;
      background:white;
      color:#be123c;
      padding:10px 12px;
      border-radius:12px;
      font-weight:950;
      font-size:13px;
      ;
      display:inline-flex;
      align-items:center;
      gap:10px;
      opacity:.95;
    }
    .assistantBtn svg{ width:18px; height:18px; }

    .navrow{
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-top:16px;
    }
    .navbtn{
      border:none;
      cursor:pointer;
      padding:10px 12px;
      border-radius:12px;
      font-weight:950;
      font-size:13px;
      background:#0f172a;
      color:white;
      display:inline-flex;
      align-items:center;
      gap:10px;
    }
    .navbtn.secondary{
      background:#f3f4f6;
      color:#0f172a;
      border:1px solid #e5e7eb;
    }
    .navbtn:disabled{ opacity:.5; cursor:not-allowed; }

    /* final exam modal */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .modal{
      width:min(860px, 100%);
      background:white;
      border-radius:18px;
      border:1px solid rgba(15,23,42,.10);
      box-shadow:0 30px 70px rgba(15,23,42,.25);
      overflow:hidden;
    }
    .modalHead{
      padding:16px 18px;
      border-bottom:1px solid #e5e7eb;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      background:#f8fafc;
      flex-wrap:wrap;
    }
    .modalHead h2{
      margin:0;
      font-size:16px;
      font-weight:950;
      letter-spacing:-.01em;
    }
    .modalHead p{
      margin:6px 0 0;
      color:#64748b;
      font-weight:700;
      font-size:13px;
      line-height:1.55;
      max-width:640px;
    }
    .closeBtn{
      border:none;
      background:#eef2f7;
      color:#0f172a;
      border-radius:12px;
      padding:10px 12px;
      font-weight:950;
      cursor:pointer;
      flex:0 0 auto;
    }
    .closeBtn:hover{ filter:brightness(.98); }

    .modalBody{
      padding:16px 18px 18px;
      max-height:min(70vh, 560px);
      overflow:auto;
    }
    .scoreRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }
    .scorePill{
      padding:8px 12px;
      border-radius:999px;
      font-size:12px;
      font-weight:950;
      border:1px solid rgba(15,23,42,.08);
      background:#f1f5f9;
      color:#0f172a;
      white-space:nowrap;
    }
    .scorePill.pass{ background:var(--green-100); color:#166534; border-color:rgba(22,101,52,.15); }
    .scorePill.fail{ background:var(--red-100); color:#991b1b; border-color:rgba(153,27,27,.18); }

    .modalActions{
      padding:14px 18px;
      border-top:1px solid #e5e7eb;
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      background:#fff;
    }

    @media (max-width: 560px){
      .container{ width:calc(100% - 28px); padding-top:26px; }
      .card{ padding:18px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="topbar">
      <a class="back" href="courses.html">
        <span aria-hidden="true">←</span>
        <span>Back to Courses</span>
      </a>
    </div>

    <div class="header">
      <div class="icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M4 7.5c0-1.4 1.1-2.5 2.5-2.5h11c1.4 0 2.5 1.1 2.5 2.5v9c0 1.4-1.1 2.5-2.5 2.5h-11C5.1 19.5 4 18.4 4 17V7.5z" stroke="white" stroke-width="2"/>
          <path d="M6.5 8.5h11" stroke="white" stroke-width="2" stroke-linecap="round"/>
          <path d="M6.5 12h9" stroke="white" stroke-width="2" stroke-linecap="round"/>
          <path d="M6.5 15.5h7" stroke="white" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>

      <div class="titlewrap">
        <h1>Email &amp; Text Phishing</h1>
        <div class="sub">
          <span id="lessonCounter">Lesson 1 of 4</span>
          <span class="chip warn" id="courseStatus">Not completed</span>
          <span class="chip" id="courseScore">Course score: —</span>
        </div>
      </div>
    </div>

    <div class="progress">
      <div class="bar"><div class="fill" id="progressFill"></div></div>
    </div>

    <div class="tabs" role="tablist" aria-label="Lessons">
      <button class="tab active" role="tab" aria-selected="true" data-lesson="1">Lesson 1</button>
      <button class="tab" role="tab" aria-selected="false" data-lesson="2"><span class="check" aria-hidden="true">✓</span> Lesson 2</button>
      <button class="tab" role="tab" aria-selected="false" data-lesson="3">Lesson 3</button>
      <button class="tab" role="tab" aria-selected="false" data-lesson="4"><span class="check" aria-hidden="true">✓</span> Lesson 4</button>
    </div>

    <div class="card" id="lessonCard"></div>

    <div class="navrow">
      <button class="navbtn secondary" id="prevBtn" type="button">Previous</button>
      <button class="navbtn" id="nextBtn" type="button">Next</button>
    </div>
  </div>

  <!-- FINAL EXAM MODAL -->
  <div class="overlay" id="examOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="examTitle">
      <div class="modalHead">
        <div>
          <h2 id="examTitle">Final Course Exam (Pass ≥ 80%)</h2>
          <p>
            This is the full course assessment. You need at least <strong>80%</strong> to successfully complete this course.
            You can retake the exam as many times as you want.
          </p>
        </div>
        <button class="closeBtn" id="closeExamBtn" type="button">Close</button>
      </div>

      <div class="modalBody">
        <div class="scoreRow">
          <span class="scorePill" id="examScorePill">Score: —</span>
          <span class="scorePill" id="examPassPill">Status: Not graded</span>
        </div>

        <div id="examQuestions"></div>

        <div class="result" id="examResult"></div>
        <div class="explain" id="examExplain"></div>
      </div>

      <div class="modalActions">
        <button class="btn secondary" id="retakeExamBtn" type="button">Retake Exam</button>
        <button class="btn primary" id="submitExamBtn" type="button">Submit Exam</button>
      </div>
    </div>
  </div>

  <script>
    // ===================== LESSON DATA =====================
    const lessons = [
      {
        title: "What Phishing Is (and Why It Works)",
        body: `
          <p>
            <strong>Phishing</strong> is when scammers send emails or texts that look real to trick you into clicking a link,
            opening an attachment, or sharing personal information (passwords, codes, bank details).
          </p>

          <h3>Why It Works:</h3>
          <ul>
            <li><strong>Looks official:</strong> logos, “billing department,” “security alert” language.</li>
            <li><strong>Urgency:</strong> “Your account will be locked,” “Payment failed,” “Confirm in 10 minutes.”</li>
            <li><strong>Confusion:</strong> Most people don’t want to make mistakes, so they click quickly.</li>
          </ul>

          <div class="examples">
            <div class="msg">
              <div class="hdr">
                <div>Text message <span>“Delivery Notice”</span></div>
                <span class="pillmini bad">Red flags</span>
              </div>
              <div class="body">
                Your package is held due to unpaid fee. Pay now to avoid return:
                <strong>ship-update.help/confirm</strong>
              </div>
            </div>

            <div class="msg">
              <div class="hdr">
                <div>Email <span>“Account Security”</span></div>
                <span class="pillmini bad">Red flags</span>
              </div>
              <div class="body">
                We noticed suspicious activity. Verify your account immediately by logging in here:
                <strong>secure-login-support.com</strong>
              </div>
            </div>
          </div>

          <div class="callout">
            <strong>Key rule:</strong> Don’t click links from messages. If it might be real, type the website yourself or use your official app.
          </div>
        `,
        quiz: {
          minPercentToPass: 80,
          questions: [
            {
              q: "What is phishing?",
              options: [
                "A phone call from a bank",
                "A scam message designed to trick you into clicking, downloading, or sharing info",
                "A normal password reset email you requested",
                "A spam ad that can’t harm you"
              ],
              answerIndex: 1,
              explain: "Phishing messages try to get you to click or share sensitive information."
            },
            {
              q: "What is the safest action if you get an urgent security email?",
              options: [
                "Click the link to fix it quickly",
                "Reply with your password to confirm your identity",
                "Type the company website yourself (or open your official app) and check there",
                "Forward it to the sender asking if it’s real"
              ],
              answerIndex: 2,
              explain: "Always verify by going to the website/app yourself, not through the message link."
            },
            {
              q: "Which is a common phishing tactic?",
              options: [
                "Giving you time to verify and call back later",
                "Using urgency and threats (account lock, fees, arrest)",
                "Mailing you a paper statement",
                "Asking you to update your address in person"
              ],
              answerIndex: 1,
              explain: "Urgency and threats push you into clicking before thinking."
            }
          ]
        }
      },
      {
        title: "Red Flags Checklist (Sender, Links, Language)",
        body: `
          <p>
            You can catch most phishing by checking three things: the <strong>sender</strong>, the <strong>link</strong>, and the <strong>message tone</strong>.
          </p>

          <h3>1) Sender Checks:</h3>
          <ul>
            <li>Display name can be fake. Always check the <strong>actual email address</strong>.</li>
            <li>Look for misspellings: <strong>support@paypaI.com</strong> (capital i) instead of paypal.</li>
            <li>Random domains: <strong>@help-security-verify.com</strong> instead of official.</li>
          </ul>

          <h3>2) Link Checks (WITHOUT Clicking):</h3>
          <ul>
            <li>Hover over links on a computer to preview the real URL.</li>
            <li>Short links hide the destination.</li>
            <li>Look-alike domains: <strong>amazon-secure-login.com</strong> is not Amazon.</li>
          </ul>

          <h3>3) Language Red Flags:</h3>
          <ul>
            <li>Urgent threats: “final notice,” “locked,” “immediately.”</li>
            <li>Weird grammar or generic greeting: “Dear customer.”</li>
            <li>Asking for codes/passwords (real companies don’t do this).</li>
          </ul>

          <div class="callout">
            <strong>Fast rule:</strong> If you didn’t expect it, don’t click it.
          </div>
        `,
        quiz: {
          minPercentToPass: 80,
          questions: [
            {
              q: "Which email is most suspicious?",
              options: [
                "support@amazon.com",
                "security@paypal.com",
                "support@paypaI.com (uses a capital i instead of l)",
                "help@bankofamerica.com"
              ],
              answerIndex: 2,
              explain: "Look-alike characters are common in phishing sender addresses."
            },
            {
              q: "What is the best way to check a link without clicking?",
              options: [
                "Click quickly and close it if it looks wrong",
                "Hover over it to preview the URL (on desktop) or long-press to preview (on mobile)",
                "Reply asking what the link is",
                "Forward it to everyone you know"
              ],
              answerIndex: 1,
              explain: "Preview the URL instead of opening it."
            },
            {
              q: "Which message tone is a red flag?",
              options: [
                "Clear and calm instructions with time to verify",
                "Threats and urgent deadlines to force action",
                "A receipt for something you just bought",
                "A newsletter you subscribed to"
              ],
              answerIndex: 1,
              explain: "Urgency and threats are used to bypass your judgment."
            }
          ]
        }
      },
      {
        title: "Dangerous Attachments + QR Code Phishing",
        body: `
          <p>
            Phishing isn’t only links. Attachments and QR codes can also lead to malware or fake login pages.
          </p>

          <h3>Attachment Traps:</h3>
          <ul>
            <li><strong>Invoice.pdf</strong>, <strong>Document.zip</strong>, <strong>Photos.html</strong> — often used to hide malware.</li>
            <li>“You have an unpaid bill” + attachment you didn’t request.</li>
            <li>Microsoft Office files asking to “Enable macros” is a major red flag.</li>
          </ul>

          <h3>QR Code Phishing (Quishing):</h3>
          <ul>
            <li>Scammers send a QR code in email/text so you can’t hover-preview the link.</li>
            <li>QR may open a fake login page for your bank or email.</li>
          </ul>

          <div class="callout">
            <strong>Rule:</strong> If you didn’t request the file/QR, don’t open it.
            Verify by typing the official website yourself.
          </div>
        `,
        quiz: {
          minPercentToPass: 80,
          questions: [
            {
              q: "Why are QR codes used in phishing?",
              options: [
                "They are always safer than links",
                "They prevent you from easily previewing the website URL",
                "They automatically protect your phone",
                "They can only open official apps"
              ],
              answerIndex: 1,
              explain: "QR codes hide the destination and make verification harder."
            },
            {
              q: "Which attachment behavior is a major red flag?",
              options: [
                "A PDF statement you expected",
                "A file asking you to enable macros to view it",
                "A photo from a family member you know and expected",
                "A document from your doctor after a confirmed appointment"
              ],
              answerIndex: 1,
              explain: "Macros are often used to run malicious code."
            },
            {
              q: "Best response to an unexpected invoice email with an attachment?",
              options: [
                "Open the attachment to see who charged you",
                "Reply asking them to explain",
                "Do not open; go to the company site/app yourself to check billing",
                "Forward to friends"
              ],
              answerIndex: 2,
              explain: "Verify directly through official channels, not through the attachment."
            }
          ]
        }
      },
      {
        title: "If You Clicked: Damage Control (Fast Steps)",
        body: `
          <p>
            If you clicked a phishing link or entered information, act quickly. The goal is to prevent account takeover and money loss.
          </p>

          <h3>If You Entered a Password:</h3>
          <ul>
            <li>Change that password immediately (and anywhere else you reused it).</li>
            <li>Turn on <strong>2-factor authentication</strong> (prefer an authenticator app if available).</li>
            <li>Check recent login activity in your account security settings.</li>
          </ul>

          <h3>If You Entered Card/Bank Info:</h3>
          <ul>
            <li>Call your bank/card using the number on your card (not the email/text).</li>
            <li>Ask about freezing card, disputing charges, and adding alerts.</li>
          </ul>

          <h3>If You Downloaded Something:</h3>
          <ul>
            <li>Run a security scan (Windows Security / antivirus).</li>
            <li>Remove suspicious downloads and browser extensions.</li>
          </ul>

          <div class="callout">
            <strong>Remember:</strong> Getting tricked isn’t “stupid.” These messages are designed to fool people.
            The important part is responding fast and safely.
          </div>
        `,
        quiz: {
          minPercentToPass: 80,
          questions: [
            {
              q: "If you typed your password into a phishing page, what should you do first?",
              options: [
                "Wait to see if anything happens",
                "Change your password and enable 2-factor authentication",
                "Send another message to the scammer",
                "Delete the email only"
              ],
              answerIndex: 1,
              explain: "Change password + enable 2FA right away to prevent takeover."
            },
            {
              q: "What number should you use to contact your bank if you entered card info?",
              options: [
                "The number in the phishing email",
                "A number you find on your card or official website",
                "Any number that answers quickly",
                "The scammer’s call-back line"
              ],
              answerIndex: 1,
              explain: "Always use the official number from your card/statement/official site."
            },
            {
              q: "Which action helps detect suspicious access quickly?",
              options: [
                "Turning off account alerts",
                "Checking recent login activity and enabling alerts",
                "Sharing your codes with support",
                "Using the same password everywhere"
              ],
              answerIndex: 1,
              explain: "Login activity + alerts helps you spot and stop account takeover."
            }
          ]
        }
      }
    ];

    // FINAL EXAM
    const finalExam = {
      passPercent: 80,
      questions: [
        {
          q: "Safest way to verify an urgent account email?",
          options: [
            "Click the link in the email",
            "Reply asking if it’s real",
            "Type the website yourself or open the official app",
            "Forward it to friends"
          ],
          answerIndex: 2,
          explain: "Always verify by navigating independently, not via message links."
        },
        {
          q: "Which sender is most suspicious?",
          options: [
            "support@company.com",
            "billing@company.com",
            "support@compаny.com (uses a look-alike character)",
            "help@company.com"
          ],
          answerIndex: 2,
          explain: "Look-alike characters/domains are common phishing tricks."
        },
        {
          q: "Why are QR codes used in phishing?",
          options: [
            "They are always safer",
            "They hide the destination and prevent easy URL preview",
            "They can only open official apps",
            "They stop malware"
          ],
          answerIndex: 1,
          explain: "QR codes make it harder to see where you’re going before opening."
        },
        {
          q: "Which is a huge red flag message style?",
          options: [
            "Calm message allowing time to verify",
            "Threats and urgency demanding immediate action",
            "A receipt you expected",
            "A newsletter you subscribed to"
          ],
          answerIndex: 1,
          explain: "Urgency/threats are used to pressure you into clicking."
        },
        {
          q: "Best response to an unexpected invoice attachment?",
          options: [
            "Open it to see details",
            "Enable macros if prompted",
            "Do not open; check billing via official website/app",
            "Send it to friends"
          ],
          answerIndex: 2,
          explain: "Verify through official channels instead of opening unknown attachments."
        },
        {
          q: "If you entered your password on a fake page, what should you do?",
          options: [
            "Wait a day",
            "Change password + enable 2FA + check login activity",
            "Reply to the email",
            "Only delete the message"
          ],
          answerIndex: 1,
          explain: "Immediate password change + 2FA prevents account takeover."
        },
        {
          q: "Which link is suspicious?",
          options: [
            "https://amazon.com",
            "https://paypal.com",
            "https://amazon-secure-login.com",
            "https://irs.gov"
          ],
          answerIndex: 2,
          explain: "Look-alike domains add extra words like 'secure-login' to fool users."
        },
        {
          q: "What should you never share in response to a message?",
          options: [
            "Your name",
            "A one-time verification code",
            "The day of the week",
            "A general question"
          ],
          answerIndex: 1,
          explain: "Codes are for you only—sharing them can allow account takeover."
        },
        {
          q: "What is a common attachment red flag?",
          options: [
            "Expected PDF statement",
            "File asking you to enable macros",
            "Photo you requested from family",
            "Document from a confirmed appointment"
          ],
          answerIndex: 1,
          explain: "Macros can run malicious code."
        },
        {
          q: "Best way to check a link without opening it?",
          options: [
            "Click quickly then close",
            "Hover-preview on desktop or long-press preview on mobile",
            "Reply asking what it is",
            "Send it to friends to test"
          ],
          answerIndex: 1,
          explain: "Preview the URL to inspect it without visiting."
        }
      ]
    };

    // ===================== STATE =====================
    const KEY = "gs_phishing_course_v1";
    const progressFill = document.getElementById("progressFill");
    const lessonCounter = document.getElementById("lessonCounter");
    const lessonCard = document.getElementById("lessonCard");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const tabs = [...document.querySelectorAll(".tab")];

    const courseStatus = document.getElementById("courseStatus");
    const courseScore = document.getElementById("courseScore");

    const examOverlay = document.getElementById("examOverlay");
    const closeExamBtn = document.getElementById("closeExamBtn");
    const submitExamBtn = document.getElementById("submitExamBtn");
    const retakeExamBtn = document.getElementById("retakeExamBtn");
    const examQuestions = document.getElementById("examQuestions");
    const examResult = document.getElementById("examResult");
    const examExplain = document.getElementById("examExplain");
    const examScorePill = document.getElementById("examScorePill");
    const examPassPill = document.getElementById("examPassPill");

    let state = {
      current: 1,
      doneLessons: [false,false,false,false],
      quizPass: [false,false,false,false],
      quizScores: [null,null,null,null],
      finalExam: { attempts: 0, bestPercent: null, passed: false }
    };

    function loadState(){
      try{
        const saved = JSON.parse(localStorage.getItem(KEY));
        if(saved) state = saved;
      }catch(e){}
      state.current = clampNum(state.current, 1, 4);
      state.doneLessons = normBoolArr(state.doneLessons, 4);
      state.quizPass = normBoolArr(state.quizPass, 4);
      state.quizScores = normScoreArr(state.quizScores, 4);
      if(!state.finalExam) state.finalExam = { attempts: 0, bestPercent: null, passed: false };
      if(typeof state.finalExam.attempts !== "number") state.finalExam.attempts = 0;
      if(typeof state.finalExam.passed !== "boolean") state.finalExam.passed = false;
    }
    function saveState(){ localStorage.setItem(KEY, JSON.stringify(state)); }

    function clampNum(n, lo, hi){
      n = Number(n);
      if(Number.isNaN(n)) return lo;
      return Math.max(lo, Math.min(hi, n));
    }
    function normBoolArr(arr, len){
      if(!Array.isArray(arr) || arr.length !== len) return Array(len).fill(false);
      return arr.map(Boolean);
    }
    function normScoreArr(arr, len){
      if(!Array.isArray(arr) || arr.length !== len) return Array(len).fill(null);
      return arr.map(v => (typeof v === "number" ? v : null));
    }

    // ===================== RENDER =====================
    function renderTopStatus(){
      if(state.finalExam.passed){
        courseStatus.textContent = "Completed";
        courseStatus.className = "chip pass";
      }else{
        const allLessonQuizzesPassed = state.quizPass.every(Boolean);
        courseStatus.textContent = allLessonQuizzesPassed ? "Ready for Final Exam" : "Not completed";
        courseStatus.className = "chip warn";
      }

      const best = state.finalExam.bestPercent;
      courseScore.textContent = (typeof best === "number")
        ? `Course score: ${best}%`
        : "Course score: —";
    }

    function lessonPercentComplete(){
      return Math.round((state.current / 4) * 100);
    }

    function renderLesson(n){
      const idx = n - 1;
      const data = lessons[idx];

      lessonCounter.textContent = `Lesson ${n} of 4`;
      progressFill.style.width = lessonPercentComplete() + "%";

      tabs.forEach(t => {
        const ln = Number(t.dataset.lesson);
        t.classList.remove("active");
        t.setAttribute("aria-selected", "false");

        if(state.doneLessons[ln - 1] && state.quizPass[ln - 1]){
          t.classList.add("done");
        }else{
          t.classList.remove("done");
        }

        if(ln === n){
          t.classList.add("active");
          t.setAttribute("aria-selected", "true");
        }
      });

      lessonCard.innerHTML = `
        <h2>${data.title}</h2>
        ${data.body}
        ${renderLessonQuiz(n)}
        
      `;

      attachLessonQuizHandlers(n);

      prevBtn.disabled = (n === 1);
      nextBtn.textContent = (n === 4) ? "Finish Lesson 4" : "Next";

      const passed = !!state.quizPass[idx];
      nextBtn.disabled = !passed;

      renderTopStatus();
    }



    function renderLessonQuiz(lessonNumber){
      const idx = lessonNumber - 1;
      const qz = lessons[idx].quiz;
      const prevScore = state.quizScores[idx];
      const passed = state.quizPass[idx];

      const statusText = passed
        ? `Passed (${prevScore}% ≥ ${qz.minPercentToPass}%)`
        : (typeof prevScore === "number"
            ? `Not passed (${prevScore}% — need ${qz.minPercentToPass}%)`
            : `You must score at least ${qz.minPercentToPass}% to continue`);

      const statusChipClass = passed ? "chip pass" : (typeof prevScore === "number" ? "chip fail" : "chip warn");

      const qs = qz.questions.map((item, qi) => {
        const name = `l${lessonNumber}_q${qi}`;
        const opts = item.options.map((opt, oi) => {
          const id = `${name}_opt${oi}`;
          return `
            <label class="opt" for="${id}">
              <input type="radio" id="${id}" name="${name}" value="${oi}">
              <span>${escapeHtml(opt)}</span>
            </label>
          `;
        }).join("");

        return `
          <div class="q" data-qi="${qi}">
            <div class="qText">${qi + 1}. ${escapeHtml(item.q)}</div>
            ${opts}
          </div>
        `;
      }).join("");

      return `
        <div class="quiz" id="lessonQuiz">
          <div class="quizHead">
            <div class="quizTitle">
              <div class="dot">Q</div>
              <span>Lesson ${lessonNumber} Checkpoint Quiz</span>
            </div>
            <span class="quizNote ${statusChipClass}" id="lessonQuizNote">${statusText}</span>
          </div>

          ${qs}

          <div class="quizActions">
            <button class="btn secondary" id="resetLessonQuizBtn" type="button">Reset</button>
            <button class="btn primary" id="submitLessonQuizBtn" type="button">Submit Quiz</button>
          </div>

          <div class="result" id="lessonQuizResult"></div>
          <div class="explain" id="lessonQuizExplain"></div>
        </div>
      `;
    }

    function attachLessonQuizHandlers(lessonNumber){
      const idx = lessonNumber - 1;
      const qz = lessons[idx].quiz;

      const note = document.getElementById("lessonQuizNote");
      const result = document.getElementById("lessonQuizResult");
      const explain = document.getElementById("lessonQuizExplain");

      const submitBtn = document.getElementById("submitLessonQuizBtn");
      const resetBtn = document.getElementById("resetLessonQuizBtn");

      resetBtn.addEventListener("click", () => {
        qz.questions.forEach((_, qi) => {
          const name = `l${lessonNumber}_q${qi}`;
          document.querySelectorAll(`input[name="${name}"]`).forEach(r => r.checked = false);
        });
        result.style.display = "none";
        explain.style.display = "none";
      });

      submitBtn.addEventListener("click", () => {
        const { percent, correctCount, total, details } = gradeLessonQuiz(lessonNumber);

        state.quizScores[idx] = percent;
        const passed = percent >= qz.minPercentToPass;
        state.quizPass[idx] = passed;
        state.doneLessons[idx] = passed;

        saveState();

        result.style.display = "block";
        result.className = "result " + (passed ? "ok" : "bad");
        result.textContent = passed
          ? `Passed! You scored ${percent}% (${correctCount}/${total}). You can continue.`
          : `Not passed. You scored ${percent}% (${correctCount}/${total}). You need ${qz.minPercentToPass}% to continue.`;

        explain.style.display = "block";
        explain.innerHTML = `
          <div style="font-weight:950; color:#0f172a; margin-bottom:6px;">Answer Review</div>
          <ul>
            ${details.map(d => `
              <li>
                <strong>Q${d.qi+1}:</strong>
                ${d.correct ? '<span style="color:#166534; font-weight:950;">Correct</span>' : '<span style="color:#991b1b; font-weight:950;">Incorrect</span>'}
                — ${escapeHtml(d.explain)}
              </li>
            `).join("")}
          </ul>
        `;

        note.textContent = passed
          ? `Passed (${percent}% ≥ ${qz.minPercentToPass}%)`
          : `Not passed (${percent}% — need ${qz.minPercentToPass}%)`;
        note.className = "quizNote " + (passed ? "chip pass" : "chip fail");

        renderLesson(state.current);
      });
    }

    function gradeLessonQuiz(lessonNumber){
      const idx = lessonNumber - 1;
      const qz = lessons[idx].quiz;

      let correctCount = 0;
      const details = [];

      qz.questions.forEach((item, qi) => {
        const name = `l${lessonNumber}_q${qi}`;
        const selected = document.querySelector(`input[name="${name}"]:checked`);
        const val = selected ? Number(selected.value) : -1;
        const correct = (val === item.answerIndex);
        if(correct) correctCount++;

        details.push({ qi, correct, explain: item.explain });
      });

      const total = qz.questions.length;
      const percent = Math.round((correctCount / total) * 100);
      return { percent, correctCount, total, details };
    }

    // ===================== NAV =====================
    function goTo(n){
      state.current = clampNum(n, 1, 4);
      saveState();
      renderLesson(state.current);
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    tabs.forEach(tab => tab.addEventListener("click", () => goTo(Number(tab.dataset.lesson))));

    prevBtn.addEventListener("click", () => {
      if(state.current > 1) goTo(state.current - 1);
    });

    nextBtn.addEventListener("click", () => {
      const idx = state.current - 1;
      if(!state.quizPass[idx]) return;

      if(state.current < 4){
        goTo(state.current + 1);
        return;
      }
      openExam();
    });

    window.addEventListener("keydown", (e) => {
      if(e.key === "ArrowLeft" && state.current > 1) goTo(state.current - 1);
      if(e.key === "ArrowRight" && state.current < 4){
        const idx = state.current - 1;
        if(state.quizPass[idx]) goTo(state.current + 1);
      }
    });

    // ===================== FINAL EXAM =====================
    function openExam(){
      const ready = state.quizPass.every(Boolean);
      if(!ready){
        alert("You must pass all lesson quizzes before taking the final exam.");
        return;
      }
      renderExamQuestions();
      examOverlay.style.display = "flex";
      examOverlay.setAttribute("aria-hidden", "false");
      examResult.style.display = "none";
      examExplain.style.display = "none";
      updateExamPills(null, null);
    }

    function closeExam(){
      examOverlay.style.display = "none";
      examOverlay.setAttribute("aria-hidden", "true");
      renderTopStatus();
    }

    closeExamBtn.addEventListener("click", closeExam);

    examOverlay.addEventListener("click", (e) => {
      if(e.target === examOverlay) closeExam();
    });

    function renderExamQuestions(){
      examQuestions.innerHTML = finalExam.questions.map((item, qi) => {
        const name = `exam_q${qi}`;
        const opts = item.options.map((opt, oi) => {
          const id = `${name}_opt${oi}`;
          return `
            <label class="opt" for="${id}">
              <input type="radio" id="${id}" name="${name}" value="${oi}">
              <span>${escapeHtml(opt)}</span>
            </label>
          `;
        }).join("");

        return `
          <div class="q">
            <div class="qText">${qi + 1}. ${escapeHtml(item.q)}</div>
            ${opts}
          </div>
        `;
      }).join("");
    }

    function resetExam(){
      finalExam.questions.forEach((_, qi) => {
        const name = `exam_q${qi}`;
        document.querySelectorAll(`input[name="${name}"]`).forEach(r => r.checked = false);
      });
      examResult.style.display = "none";
      examExplain.style.display = "none";
      updateExamPills(null, null);
    }

    document.getElementById("retakeExamBtn").addEventListener("click", resetExam);

    document.getElementById("submitExamBtn").addEventListener("click", () => {
      const graded = gradeExam();
      state.finalExam.attempts += 1;

      if(typeof state.finalExam.bestPercent !== "number" || graded.percent > state.finalExam.bestPercent){
        state.finalExam.bestPercent = graded.percent;
      }

      const passed = graded.percent >= finalExam.passPercent;
      state.finalExam.passed = passed;

      saveState();

      examResult.style.display = "block";
      examResult.className = "result " + (passed ? "ok" : "bad");
      examResult.textContent = passed
        ? `Passed! You scored ${graded.percent}% (${graded.correctCount}/${graded.total}). Course completed.`
        : `Not passed. You scored ${graded.percent}% (${graded.correctCount}/${graded.total}). You need ${finalExam.passPercent}% to pass.`;

      examExplain.style.display = "block";
      examExplain.innerHTML = `
        <div style="font-weight:950; color:#0f172a; margin-bottom:6px;">Answer Review</div>
        <ul>
          ${graded.details.map(d => `
            <li>
              <strong>Q${d.qi+1}:</strong>
              ${d.correct ? '<span style="color:#166534; font-weight:950;">Correct</span>' : '<span style="color:#991b1b; font-weight:950;">Incorrect</span>'}
              — ${escapeHtml(d.explain)}
            </li>
          `).join("")}
        </ul>
      `;

      updateExamPills(graded.percent, passed);
      renderTopStatus();

      if(passed){
        setTimeout(() => { window.location.href = "courses.html"; }, 900);
      }
    });

    function gradeExam(){
      let correctCount = 0;
      const details = [];

      finalExam.questions.forEach((item, qi) => {
        const name = `exam_q${qi}`;
        const selected = document.querySelector(`input[name="${name}"]:checked`);
        const val = selected ? Number(selected.value) : -1;
        const correct = (val === item.answerIndex);
        if(correct) correctCount++;
        details.push({ qi, correct, explain: item.explain });
      });

      const total = finalExam.questions.length;
      const percent = Math.round((correctCount / total) * 100);
      return { percent, correctCount, total, details };
    }

    function updateExamPills(percent, passed){
      if(typeof percent !== "number"){
        examScorePill.textContent = "Score: —";
        examScorePill.className = "scorePill";
        examPassPill.textContent = "Status: Not graded";
        examPassPill.className = "scorePill";
        return;
      }

      examScorePill.textContent = `Score: ${percent}%`;
      examScorePill.className = "scorePill " + (passed ? "pass" : "fail");
      examPassPill.textContent = passed ? "Status: Passed" : `Status: Not passed (need ≥ ${finalExam.passPercent}%)`;
      examPassPill.className = "scorePill " + (passed ? "pass" : "fail");
    }

    // ===================== HELPERS =====================
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ===================== INIT =====================
    loadState();
    renderTopStatus();
    renderLesson(state.current);
  </script>
  <script src="shared/assistant.js"></script>
</body>
</html>
