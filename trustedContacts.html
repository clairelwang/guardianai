<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trusted Contacts ‚Äì Guardian Shield</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    .mini-bar {
      position: fixed;
      top: 14px;
      left: 56px; /* aligns with text */
      z-index: 9999;
      display: flex;
      gap: 8px;
      background: #ffffff;
      padding: 6px 8px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
    .mini-bar select {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      font-size: 14px;
      cursor: pointer;
      background:#fff;
      outline:none;
    }
    .mini-bar button {
      border: none;
      background: #f3f4f6;
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size:14px;
    }
    .mini-bar button:hover { background: #e5e7eb; }

    :root{
      --ink:#0f172a;
      --muted:#64748b;
      --line:#e5e7eb;
      --bg:#f8fafc;
      --card:#ffffff;
      --shadow:0 14px 30px rgba(15,23,42,.06);
      --radius:18px;

      --green:#16a34a;
      --green-bg:#ecfdf5;
      --green-line:#bbf7d0;

      --blue:#2563eb;
      --blue-bg:#eff6ff;
      --blue-line:#bfdbfe;

      --purple:#7c3aed;
      --purple-bg:#f5f3ff;
      --purple-line:#ddd6fe;

      --btn:#0f8f5a;
      --btn-hover:#0b7a4c;

      --info-bg:#eef6ff;
      --info-line:#cfe3ff;

      --danger:#ef4444;
      --danger-bg:#fef2f2;
      --danger-line:#fecaca;

      --amber:#f59e0b;
      --amber-bg:#fffbeb;
      --amber-line:#fde68a;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--ink);
    }

    .container{
      width:min(1180px, calc(100% - 64px));
      margin:0 auto;
      padding:80px 0 110px;
    }

    /* Header */
    .head{
      text-align:center;
      margin-bottom:44px;
    }
    .headIcon{
      width:56px;
      height:56px;
      margin:0 auto 18px;
      border-radius:16px;
      background:#dcfce7;
      display:grid;
      place-items:center;
      color:var(--green);
    }
    h1{
      margin:0 0 10px;
      font-size:36px;
      font-weight:800;
      letter-spacing:-.03em;
    }
    .sub{
      max-width:820px;
      margin:0 auto;
      color:var(--muted);
      font-size:16px;
      line-height:1.65;
      font-weight:500;
    }

    /* Feature cards */
    .featureRow{
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:22px;
      margin:52px 0 26px;
      align-items:stretch;
    }
    .feature{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      padding:26px 20px;
      text-align:center;
      box-shadow:var(--shadow);
    }
    .feature.green{ background:var(--green-bg); border-color:var(--green-line); }
    .feature.blue{ background:var(--blue-bg); border-color:var(--blue-line); }
    .feature.purple{ background:var(--purple-bg); border-color:var(--purple-line); }

    .featIcon{
      width:44px;height:44px;
      margin:0 auto 14px;
      display:grid;
      place-items:center;
      color:currentColor;
    }
    .feature.green .featIcon{ color:var(--green); }
    .feature.blue .featIcon{ color:var(--blue); }
    .feature.purple .featIcon{ color:var(--purple); }

    .feature h3{
      margin:0 0 6px;
      font-size:14px;
      font-weight:800;
      letter-spacing:.01em;
    }
    .feature p{
      margin:0;
      font-size:13px;
      line-height:1.55;
      color:#475569;
      font-weight:600;
    }

    /* Main layout */
    .layout{
      display:grid;
      grid-template-columns: 1.08fr .92fr;
      gap:22px;
      align-items:start;
      margin-top:18px;
    }

    /* Card */
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .cardHead{
      padding:18px 18px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
    }
    .cardHead h2{
      margin:0;
      font-size:15px;
      font-weight:900;
      letter-spacing:-.01em;
    }
    .cardHead p{
      margin:6px 0 0;
      color:var(--muted);
      font-weight:600;
      font-size:13px;
      line-height:1.55;
      max-width:740px;
    }

    /* Buttons */
    .btnRow{
      display:flex;
      justify-content:flex-end;
      gap:10px;
    }
    .btn{
      height:38px;
      padding:0 16px;
      border-radius:8px;
      border:1px solid rgba(0,0,0,.08);
      background:var(--btn);
      color:#fff;
      font-weight:800;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      box-shadow:0 12px 22px rgba(15,23,42,.08);
      white-space:nowrap;
    }
    .btn:hover{ background:var(--btn-hover); }
    .btn.secondary{
      background:#0f172a;
    }
    .btn.secondary:hover{
      background:#111827;
    }
    .btn.ghost{
      background:#f1f5f9;
      color:#0f172a;
      box-shadow:none;
    }
    .btn.ghost:hover{ background:#e5e7eb; }

    .btn svg{ display:block; }

    /* Contacts list */
    .contactsWrap{ padding:16px 16px 18px; }
    .empty{
      border:1px dashed #cbd5e1;
      border-radius:14px;
      padding:22px 16px;
      text-align:center;
      color:var(--muted);
      font-weight:700;
      background:#fbfdff;
    }

    .list{
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-top:10px;
    }
    .contact{
      border:1px solid #e6edf7;
      border-radius:14px;
      padding:14px 14px;
      background:#ffffff;
      display:flex;
      gap:12px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .left{
      display:flex;
      gap:12px;
      align-items:flex-start;
    }
    .avatar{
      width:40px;
      height:40px;
      border-radius:12px;
      display:grid;
      place-items:center;
      background:#f1f5f9;
      border:1px solid #e5e7eb;
      color:#0f172a;
      font-weight:900;
      flex:0 0 auto;
    }
    .cname{
      margin:0;
      font-size:14px;
      font-weight:900;
      color:#0f172a;
      line-height:1.2;
    }
    .cmeta{
      margin:6px 0 0;
      color:#64748b;
      font-weight:700;
      font-size:12.5px;
      line-height:1.45;
    }
    .tags{
      margin-top:8px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      border:1px solid rgba(15,23,42,.08);
      background:#f1f5f9;
      color:#0f172a;
      white-space:nowrap;
    }
    .tag.primary{ background:var(--green-bg); color:#166534; border-color:rgba(22,101,52,.15); }
    .tag.verify{ background:var(--blue-bg); color:#1d4ed8; border-color:rgba(29,78,216,.18); }
    .tag.emergency{ background:var(--danger-bg); color:#991b1b; border-color:rgba(153,27,27,.18); }
    .tag.sms{ background:#fff7ed; color:#9a3412; border-color:#fed7aa; }
    .tag.call{ background:#f0f9ff; color:#075985; border-color:#bae6fd; }

    .actions{
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:flex-end;
    }
    .smallBtn{
      height:34px;
      padding:0 12px;
      border-radius:10px;
      border:1px solid #e5e7eb;
      background:#f8fafc;
      color:#0f172a;
      font-weight:900;
      font-size:12.5px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .smallBtn:hover{ background:#eef2f7; }
    .smallBtn.danger{
      background:#fff1f2;
      border-color:#fecdd3;
      color:#9f1239;
    }
    .smallBtn.danger:hover{ background:#ffe4e6; }

    /* AI Assist Card (mock) */
    .aiWrap{ padding:16px 16px 18px; }
    .aiBanner{
      display:flex;
      gap:12px;
      align-items:flex-start;
      padding:14px 14px;
      border-radius:14px;
      background: linear-gradient(180deg, #eff6ff 0%, #ffffff 100%);
      border:1px solid #c7ddff;
    }
    .aiIcon{
      width:42px;height:42px;
      border-radius:14px;
      display:grid;
      place-items:center;
      background:#eaf2ff;
      color:#2563eb;
      border:1px solid #bfdbfe;
      flex:0 0 auto;
      font-weight:900;
    }
    .aiBanner h3{
      margin:0;
      font-size:14px;
      font-weight:900;
      color:#0f172a;
    }
    .aiBanner p{
      margin:6px 0 0;
      color:#475569;
      font-weight:700;
      font-size:12.8px;
      line-height:1.55;
    }

    .aiBox{
      margin-top:12px;
      border:1px solid #e5e7eb;
      border-radius:14px;
      background:#ffffff;
      overflow:hidden;
    }
    .aiBoxHead{
      padding:12px 12px;
      border-bottom:1px solid #e5e7eb;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:#f8fafc;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      border:1px solid rgba(15,23,42,.08);
      background:#f1f5f9;
      color:#0f172a;
      white-space:nowrap;
    }
    .pill.mock{
      background:#fffbeb;
      border-color:var(--amber-line);
      color:#92400e;
    }
    .aiChat{
      padding:12px 12px 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .msg{
      max-width:92%;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid #e5e7eb;
      background:#ffffff;
      font-weight:700;
      font-size:13px;
      line-height:1.55;
      color:#0f172a;
    }
    .msg.ai{
      background:#eff6ff;
      border-color:#bfdbfe;
    }
    .msg.me{
      margin-left:auto;
      background:#f1f5f9;
    }
    .aiInputRow{
      display:flex;
      gap:10px;
      padding:12px 12px;
      border-top:1px solid #e5e7eb;
      background:#ffffff;
    }
    .aiInput{
      flex:1;
      height:40px;
      border-radius:12px;
      border:1px solid #e5e7eb;
      padding:0 12px;
      font-weight:700;
      outline:none;
      background:#fff;
    }
    .sendBtn{
      height:40px;
      padding:0 14px;
      border-radius:12px;
      border:1px solid rgba(0,0,0,.08);
      background:#0f172a;
      color:#fff;
      font-weight:900;
      cursor:pointer;
      white-space:nowrap;
    }
    .sendBtn:hover{ background:#111827; }

    /* Help box */
    .help{
      margin-top:18px;
      background:var(--info-bg);
      border:1px solid var(--info-line);
      border-radius:12px;
      padding:18px 18px;
      display:flex;
      gap:14px;
      align-items:flex-start;
    }
    .helpIcon{
      width:28px;height:28px;
      border-radius:999px;
      display:grid;
      place-items:center;
      color:#2563eb;
      flex:0 0 auto;
      margin-top:2px;
    }
    .help h5{
      margin:0 0 10px;
      font-size:14px;
      font-weight:900;
      color:#0f172a;
    }
    .help ul{
      margin:0;
      padding-left:0;
      list-style:none;
      display:flex;
      flex-direction:column;
      gap:10px;
      color:#0f172a;
      font-weight:600;
      font-size:13.5px;
      line-height:1.55;
    }
    .help li{
      display:flex;
      gap:10px;
      align-items:flex-start;
      color:#0f172a;
    }
    .tick{
      color:#0ea5e9;
      font-weight:900;
      margin-top:1px;
    }

    /* Modal */
    .modalOverlay{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:99999;
    }
    .modal{
      width:min(560px, 100%);
      background:#fff;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.2);
      box-shadow: 0 30px 70px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .modalHead{
      padding:16px 16px;
      border-bottom:1px solid #e5e7eb;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      background:#f8fafc;
    }
    .modalHead h3{
      margin:0;
      font-size:14px;
      font-weight:900;
    }
    .xBtn{
      width:38px;height:38px;
      border-radius:12px;
      border:1px solid #e5e7eb;
      background:#fff;
      cursor:pointer;
      font-weight:900;
    }
    .xBtn:hover{ background:#eef2f7; }

    .modalBody{
      padding:16px 16px 18px;
    }
    .grid2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    label{
      display:block;
      font-size:12px;
      font-weight:900;
      color:#0f172a;
      margin-bottom:6px;
    }
    input, select{
      width:100%;
      height:42px;
      border-radius:12px;
      border:1px solid #e5e7eb;
      padding:0 12px;
      font-weight:700;
      outline:none;
      background:#fff;
    }
    input:focus, select:focus{
      border-color:#93c5fd;
      box-shadow:0 0 0 4px rgba(37,99,235,.12);
    }
    .row{
      margin-top:12px;
    }
    .toggleRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:8px;
    }
    .toggle{
      border:1px solid #e5e7eb;
      background:#f8fafc;
      border-radius:999px;
      padding:8px 10px;
      font-size:12px;
      font-weight:900;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .toggle.active{
      background:#0f172a;
      border-color:#0f172a;
      color:#fff;
    }

    .modalFoot{
      padding:14px 16px;
      border-top:1px solid #e5e7eb;
      display:flex;
      gap:10px;
      justify-content:flex-end;
      background:#fff;
    }
    .btnLite{
      height:38px;
      padding:0 14px;
      border-radius:10px;
      border:1px solid #e5e7eb;
      background:#fff;
      font-weight:900;
      cursor:pointer;
    }
    .btnLite:hover{ background:#eef2f7; }
    .btnPrimary{
      height:38px;
      padding:0 14px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,.08);
      background:var(--btn);
      color:#fff;
      font-weight:900;
      cursor:pointer;
    }
    .btnPrimary:hover{ background:var(--btn-hover); }

    /* Responsive */
    @media (max-width: 980px){
      .featureRow{ grid-template-columns:1fr; }
      .layout{ grid-template-columns:1fr; }
      .container{ width:min(980px, calc(100% - 28px)); }
      .btnRow{ justify-content:center; }
    }
    @media (max-width: 520px){
      .grid2{ grid-template-columns:1fr; }
    }
  </style>
</head>

<body>
  <!-- Mini Page Switcher -->
  <div class="mini-bar">
    <select id="pageSelect">
      <option value="index.html">Home</option>
      <option value="scamanalyzer.html">ScamAnalyzer</option>
      <option value="courses.html">Courses</option>
      <option value="trustedContacts.html">TrustedContacts</option>
      <option value="alerts.html">Alerts</option>
      <option value="simulator.html">Simulator</option>
      <option value="report.html">Report</option>
    </select>

    <button onclick="toggleMobileView()" title="Mobile view">üì±</button>
    <button onclick="location.reload()" title="Refresh">‚ü≥</button>
  </div>

  <div class="container">

    <div class="head">
      <div class="headIcon" aria-hidden="true">
        <!-- people icon -->
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
          <path d="M16 11a3.2 3.2 0 1 0-6.4 0A3.2 3.2 0 0 0 16 11Z" stroke="currentColor" stroke-width="2"/>
          <path d="M20 20c0-3.2-3.1-5-6.8-5S6.4 16.8 6.4 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M7.2 10.6a2.7 2.7 0 1 1 0-5.4" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity=".6"/>
          <path d="M4 19.6c.2-2 1.3-3.3 3.3-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity=".6"/>
        </svg>
      </div>

      <h1>Trusted Contacts</h1>
      <p class="sub">
        Make ‚Äúpause + verify‚Äù realistic. Add people you trust, choose how they can help, and use the AI (mock) to draft a quick verification message.
        The contact tools below work locally in your browser (no accounts needed).
      </p>
    </div>

    <!-- Feature cards -->
    <div class="featureRow">
      <div class="feature green">
        <div class="featIcon" aria-hidden="true">
          <!-- shield -->
          <svg width="34" height="34" viewBox="0 0 24 24" fill="none">
            <path d="M12 3l7 4v6c0 5-3.1 8-7 9-3.9-1-7-4-7-9V7l7-4Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </div>
        <h3>Feasible Verification</h3>
        <p>Send a pre-written ‚Äúverify this‚Äù text/call plan instead of guessing what to say.</p>
      </div>

      <div class="feature blue">
        <div class="featIcon" aria-hidden="true">
          <!-- bell -->
          <svg width="34" height="34" viewBox="0 0 24 24" fill="none">
            <path d="M18 8a6 6 0 10-12 0c0 7-3 7-3 7h18s-3 0-3-7Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M10 18a2 2 0 004 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <h3>Share What Happened</h3>
        <p>Quickly copy a summary and share it with a trusted person for a second opinion.</p>
      </div>

      <div class="feature purple">
        <div class="featIcon" aria-hidden="true">
          <!-- spark icon -->
          <svg width="34" height="34" viewBox="0 0 24 24" fill="none">
            <path d="M12 2l1.2 4.3L17 8l-3.8 1.7L12 14l-1.2-4.3L7 8l3.8-1.7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M19 13l.7 2.5L22 16l-2.3.5L19 19l-.7-2.5L16 16l2.3-.5L19 13Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round" opacity=".7"/>
          </svg>
        </div>
        <h3>AI Draft Helper (Mock)</h3>
        <p>Type what happened and get a clear message template to send to family/friends.</p>
      </div>
    </div>

    <div class="layout">

      <!-- CONTACTS -->
      <div class="card">
        <div class="cardHead">
          <div>
            <h2>Your Trusted Contacts</h2>
            <p>
              Add a few people and set their role. Example: one ‚ÄúPrimary Contact‚Äù who gets called first,
              and one ‚ÄúVerifier‚Äù who helps confirm suspicious requests.
            </p>
          </div>

          <div class="btnRow">
            <button class="btn secondary" type="button" id="copyPlanBtn" title="Copy a verification plan">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M9 9h10v10H9V9Z" stroke="#fff" stroke-width="2" />
                <path d="M5 15H4a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v1" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Copy Verification Plan
            </button>

            <button class="btn" type="button" id="addBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M15 20c0-3-3-5-6-5s-6 2-6 5" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
                <path d="M9 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke="#fff" stroke-width="2"/>
                <path d="M19 8v6" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
                <path d="M16 11h6" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Add Contact
            </button>
          </div>
        </div>

        <div class="contactsWrap">
          <div id="emptyState" class="empty">
            No trusted contacts yet. Click <strong>Add Contact</strong> to create one.
          </div>

          <div id="list" class="list" style="display:none;"></div>
        </div>
      </div>

      <!-- AI DRAFT (mock UI but page works) -->
      <div class="card">
        <div class="cardHead">
          <div>
            <h2>AI Message Draft (Not functional)</h2>
            <p>
              This simulates an AI assistant that drafts a message you can send to a trusted contact.
              The ‚ÄúSend‚Äù button does not contact anyone‚Äîthis is a safe mock demo.
            </p>
          </div>
          <span class="pill mock">Mock AI</span>
        </div>

        <div class="aiWrap">
          <div class="aiBanner">
            <div class="aiIcon">AI</div>
            <div>
              <h3>Draft a verification message</h3>
              <p>
                Describe what happened (call/text/email). The mock assistant will output a clean message template you can copy.
              </p>
            </div>
          </div>

          <div class="aiBox" aria-label="Mock AI chat">
            <div class="aiBoxHead">
              <span class="pill">Recommended prompt</span>
              <button class="btn ghost" type="button" id="insertPromptBtn">Insert Example</button>
            </div>

            <div class="aiChat" id="chat">
              <div class="msg ai">
                Hi! Paste what happened (who contacted you, what they asked for, and how urgent it felt). I‚Äôll draft a short message to send to your trusted contact.
              </div>
            </div>

            <div class="aiInputRow">
              <input class="aiInput" id="aiInput" placeholder="Example: 'A caller said they were my bank and told me to move money right now...'" />
              <button class="sendBtn" type="button" id="mockSendBtn">Send</button>
            </div>
          </div>

          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
            <button class="smallBtn" type="button" id="copyDraftBtn">Copy Latest Draft</button>
            <button class="smallBtn" type="button" id="clearChatBtn">Clear</button>
          </div>
        </div>
      </div>

    </div>

    <!-- Help box -->
    <div class="help">
      <div class="helpIcon" aria-hidden="true">
        <!-- info -->
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
          <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" stroke="currentColor" stroke-width="2"/>
          <path d="M12 10v7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M12 7.2h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
        </svg>
      </div>

      <div>
        <h5>How Trusted Contacts Help (Realistic + Actionable)</h5>
        <ul>
          <li><span class="tick">‚úì</span><span><strong>Primary Contact:</strong> the person you call first when something feels urgent.</span></li>
          <li><span class="tick">‚úì</span><span><strong>Verifier:</strong> checks details (calls back using official numbers, confirms identity).</span></li>
          <li><span class="tick">‚úì</span><span><strong>Emergency:</strong> someone you can call if you shared money/info and need quick help.</span></li>
          <li><span class="tick">‚úì</span><span>Use a <strong>family code word</strong> to verify identity during suspicious calls.</span></li>
        </ul>
      </div>
    </div>

  </div>

  <!-- MODAL: ADD/EDIT CONTACT -->
  <div class="modalOverlay" id="modalOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHead">
        <h3 id="modalTitle">Add Trusted Contact</h3>
        <button class="xBtn" type="button" id="closeModalBtn" aria-label="Close">‚úï</button>
      </div>

      <div class="modalBody">
        <div class="grid2">
          <div>
            <label for="nameInput">Name</label>
            <input id="nameInput" placeholder="Example: Maria Chen" />
          </div>
          <div>
            <label for="relationInput">Relationship</label>
            <input id="relationInput" placeholder="Example: Daughter, Friend, Neighbor" />
          </div>
        </div>

        <div class="grid2" style="margin-top:12px;">
          <div>
            <label for="phoneInput">Phone (optional)</label>
            <input id="phoneInput" placeholder="Example: (555) 123-4567" />
          </div>
          <div>
            <label for="methodSelect">Preferred Method</label>
            <select id="methodSelect">
              <option value="Call">Call</option>
              <option value="Text">Text</option>
              <option value="Email">Email</option>
            </select>
          </div>
        </div>

        <div class="row">
          <label>Roles (choose any)</label>
          <div class="toggleRow">
            <button class="toggle" type="button" data-role="Primary">Primary Contact</button>
            <button class="toggle" type="button" data-role="Verifier">Verifier</button>
            <button class="toggle" type="button" data-role="Emergency">Emergency</button>
          </div>
        </div>

        <div class="row">
          <label for="notesInput">Notes (optional)</label>
          <input id="notesInput" placeholder="Example: ‚ÄòKnows my bank, can help call them back‚Äô" />
        </div>

        <input type="hidden" id="editId" value="" />
      </div>

      <div class="modalFoot">
        <button class="btnLite" type="button" id="cancelBtn">Cancel</button>
        <button class="btnPrimary" type="button" id="saveBtn">Save Contact</button>
      </div>
    </div>
  </div>

  <script>
    /* ---------------- MINI BAR NAV ---------------- */
    const pageSelect = document.getElementById("pageSelect");
    const currentPage = location.pathname.split("/").pop() || "index.html";
    [...pageSelect.options].forEach(opt => {
      if (opt.value === currentPage) opt.selected = true;
    });
    pageSelect.addEventListener("change", () => {
      location.href = pageSelect.value;
    });

    function toggleMobileView() {
      const meta = document.querySelector('meta[name="viewport"]');
      if (!meta) return;
      if (meta.content.includes("width=375")) {
        meta.content = "width=device-width, initial-scale=1";
      } else {
        meta.content = "width=375, initial-scale=1";
      }
    }

    /* ---------------- TRUSTED CONTACTS (WORKING) ---------------- */
    const STORAGE_KEY = "guardian_trusted_contacts_v1";

    const addBtn = document.getElementById("addBtn");
    const copyPlanBtn = document.getElementById("copyPlanBtn");
    const listEl = document.getElementById("list");
    const emptyState = document.getElementById("emptyState");

    // modal elements
    const modalOverlay = document.getElementById("modalOverlay");
    const closeModalBtn = document.getElementById("closeModalBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    const saveBtn = document.getElementById("saveBtn");

    const nameInput = document.getElementById("nameInput");
    const relationInput = document.getElementById("relationInput");
    const phoneInput = document.getElementById("phoneInput");
    const methodSelect = document.getElementById("methodSelect");
    const notesInput = document.getElementById("notesInput");
    const editId = document.getElementById("editId");
    const roleBtns = Array.from(document.querySelectorAll(".toggle[data-role]"));

    function loadContacts(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      }catch(e){
        return [];
      }
    }
    function saveContacts(contacts){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(contacts));
    }

    function initials(name){
      const parts = String(name || "").trim().split(/\s+/).filter(Boolean);
      if(!parts.length) return "TC";
      const a = parts[0][0] || "";
      const b = parts.length > 1 ? (parts[parts.length - 1][0] || "") : "";
      return (a + b).toUpperCase();
    }

    function openModal(mode, contact){
      document.getElementById("modalTitle").textContent = mode === "edit" ? "Edit Trusted Contact" : "Add Trusted Contact";
      modalOverlay.style.display = "flex";
      modalOverlay.setAttribute("aria-hidden", "false");

      // reset toggles
      roleBtns.forEach(b => b.classList.remove("active"));

      if(mode === "edit" && contact){
        editId.value = contact.id;
        nameInput.value = contact.name || "";
        relationInput.value = contact.relationship || "";
        phoneInput.value = contact.phone || "";
        methodSelect.value = contact.method || "Call";
        notesInput.value = contact.notes || "";
        (contact.roles || []).forEach(r => {
          const btn = roleBtns.find(x => x.dataset.role === r);
          if(btn) btn.classList.add("active");
        });
      }else{
        editId.value = "";
        nameInput.value = "";
        relationInput.value = "";
        phoneInput.value = "";
        methodSelect.value = "Call";
        notesInput.value = "";
      }

      setTimeout(() => nameInput.focus(), 50);
    }

    function closeModal(){
      modalOverlay.style.display = "none";
      modalOverlay.setAttribute("aria-hidden", "true");
    }

    roleBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        btn.classList.toggle("active");
      });
    });

    addBtn.addEventListener("click", () => openModal("add"));
    closeModalBtn.addEventListener("click", closeModal);
    cancelBtn.addEventListener("click", closeModal);
    modalOverlay.addEventListener("click", (e) => {
      if(e.target === modalOverlay) closeModal();
    });
    document.addEventListener("keydown", (e) => {
      if(e.key === "Escape" && modalOverlay.style.display === "flex") closeModal();
    });

    function render(){
      const contacts = loadContacts();
      if(!contacts.length){
        emptyState.style.display = "block";
        listEl.style.display = "none";
        listEl.innerHTML = "";
        return;
      }
      emptyState.style.display = "none";
      listEl.style.display = "flex";
      listEl.innerHTML = "";

      contacts.forEach(c => {
        const card = document.createElement("div");
        card.className = "contact";

        const left = document.createElement("div");
        left.className = "left";

        const av = document.createElement("div");
        av.className = "avatar";
        av.textContent = initials(c.name);

        const info = document.createElement("div");

        const title = document.createElement("p");
        title.className = "cname";
        title.textContent = c.name || "Unnamed Contact";

        const meta = document.createElement("p");
        meta.className = "cmeta";
        const rel = c.relationship ? `‚Ä¢ ${c.relationship}` : "";
        const phone = c.phone ? `‚Ä¢ ${c.phone}` : "";
        meta.textContent = `${c.method || "Call"} ${rel} ${phone}`.trim();

        const tags = document.createElement("div");
        tags.className = "tags";

        const roles = Array.isArray(c.roles) ? c.roles : [];
        if(roles.includes("Primary")){
          const t = document.createElement("span");
          t.className = "tag primary";
          t.textContent = "Primary";
          tags.appendChild(t);
        }
        if(roles.includes("Verifier")){
          const t = document.createElement("span");
          t.className = "tag verify";
          t.textContent = "Verifier";
          tags.appendChild(t);
        }
        if(roles.includes("Emergency")){
          const t = document.createElement("span");
          t.className = "tag emergency";
          t.textContent = "Emergency";
          tags.appendChild(t);
        }

        const m = (c.method || "Call").toLowerCase();
        const methodTag = document.createElement("span");
        methodTag.className = "tag " + (m === "text" ? "sms" : "call");
        methodTag.textContent = (c.method || "Call");
        tags.appendChild(methodTag);

        if(c.notes){
          const noteTag = document.createElement("span");
          noteTag.className = "tag";
          noteTag.textContent = "Notes";
          noteTag.title = c.notes;
          tags.appendChild(noteTag);
        }

        info.appendChild(title);
        info.appendChild(meta);
        info.appendChild(tags);

        left.appendChild(av);
        left.appendChild(info);

        const actions = document.createElement("div");
        actions.className = "actions";

        const verifyBtn = document.createElement("button");
        verifyBtn.className = "smallBtn";
        verifyBtn.type = "button";
        verifyBtn.textContent = "Copy Verify Message";
        verifyBtn.addEventListener("click", () => {
          const text = buildVerifyMessage(c);
          copyText(text);
          toast("Copied verification message.");
        });

        const editBtn = document.createElement("button");
        editBtn.className = "smallBtn";
        editBtn.type = "button";
        editBtn.textContent = "Edit";
        editBtn.addEventListener("click", () => openModal("edit", c));

        const delBtn = document.createElement("button");
        delBtn.className = "smallBtn danger";
        delBtn.type = "button";
        delBtn.textContent = "Remove";
        delBtn.addEventListener("click", () => {
          const contactsNow = loadContacts().filter(x => x.id !== c.id);
          saveContacts(contactsNow);
          render();
          toast("Contact removed.");
        });

        actions.appendChild(verifyBtn);
        actions.appendChild(editBtn);
        actions.appendChild(delBtn);

        card.appendChild(left);
        card.appendChild(actions);

        listEl.appendChild(card);
      });
    }

    function buildVerifyMessage(contact){
      const name = contact.name || "there";
      const method = contact.method || "Call";
      const roles = (contact.roles || []).join(", ");
      return (
`Hi ${name} ‚Äî quick check: I just got a suspicious message/call.
Can you help me verify it before I respond?

What happened:
‚Ä¢ Type: (call/text/email)
‚Ä¢ Who they claimed to be:
‚Ä¢ What they asked for:
‚Ä¢ How urgent they made it sound:

My plan:
1) I will NOT click links or share codes.
2) I will call back using an official number (not the one provided).
3) If it involves money/info, I‚Äôll pause and verify with you.

Your role: ${roles || "Trusted Contact"} ‚Ä¢ Preferred method: ${method}`
      );
    }

    function collectRolesFromUI(){
      return roleBtns.filter(b => b.classList.contains("active")).map(b => b.dataset.role);
    }

    saveBtn.addEventListener("click", () => {
      const name = nameInput.value.trim();
      if(!name){
        toast("Please enter a name.");
        nameInput.focus();
        return;
      }

      const contact = {
        id: editId.value || String(Date.now()) + "_" + Math.random().toString(16).slice(2),
        name,
        relationship: relationInput.value.trim(),
        phone: phoneInput.value.trim(),
        method: methodSelect.value,
        roles: collectRolesFromUI(),
        notes: notesInput.value.trim()
      };

      const contacts = loadContacts();
      const idx = contacts.findIndex(x => x.id === contact.id);
      if(idx >= 0) contacts[idx] = contact;
      else contacts.unshift(contact);

      saveContacts(contacts);
      closeModal();
      render();
      toast(idx >= 0 ? "Contact updated." : "Contact added.");
    });

    copyPlanBtn.addEventListener("click", () => {
      const text =
`Quick Verification Plan (Guardian Shield)

1) Pause: do not act immediately.
2) Verify independently:
   - Call the company/person using a saved or official number.
   - Never use a number/link provided in the message.
3) Never share:
   - passwords, 2FA codes, gift card numbers, bank login, remote access.
4) If money/info was shared:
   - Contact bank/provider immediately and tell a trusted contact.
5) If it feels urgent or secret: treat it as suspicious.

Tip: Set a family code word for emergencies.`;

      copyText(text);
      toast("Copied verification plan.");
    });

    /* ---------------- MOCK AI (non-functional, but UI works) ---------------- */
    const chat = document.getElementById("chat");
    const aiInput = document.getElementById("aiInput");
    const mockSendBtn = document.getElementById("mockSendBtn");
    const insertPromptBtn = document.getElementById("insertPromptBtn");
    const copyDraftBtn = document.getElementById("copyDraftBtn");
    const clearChatBtn = document.getElementById("clearChatBtn");

    let latestDraft = "";

    insertPromptBtn.addEventListener("click", () => {
      aiInput.value = "A caller said they were my bank. They told me my account was hacked and I need to move money now. They asked for a code they texted me.";
      aiInput.focus();
    });

    function addMsg(text, cls){
      const div = document.createElement("div");
      div.className = "msg " + cls;
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function makeMockDraft(userText){
      // Not real AI. Just a safe template generator.
      const trimmed = String(userText || "").trim();
      const summary = trimmed ? trimmed.slice(0, 220) + (trimmed.length > 220 ? "‚Ä¶" : "") : "(no details provided)";
      return (
`Draft message to send:

‚ÄúHi ‚Äî I received something suspicious and I want a second opinion before I respond.
Summary: ${summary}

Can you help me verify:
1) Who this is really from (call back using official numbers)?
2) Whether I should ignore/report it?

I will NOT share passwords or verification codes, and I won‚Äôt click any links.‚Äù`
      );
    }

    function handleSend(){
      const text = aiInput.value.trim();
      if(!text){
        toast("Type what happened first.");
        aiInput.focus();
        return;
      }

      addMsg(text, "me");

      // ‚Äúmock AI response‚Äù
      latestDraft = makeMockDraft(text);
      addMsg(latestDraft, "ai");

      aiInput.value = "";
      aiInput.focus();
    }

    mockSendBtn.addEventListener("click", handleSend);
    aiInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter"){
        e.preventDefault();
        handleSend();
      }
    });

    copyDraftBtn.addEventListener("click", () => {
      if(!latestDraft){
        toast("No draft yet. Send a message first.");
        return;
      }
      copyText(latestDraft);
      toast("Copied latest draft.");
    });

    clearChatBtn.addEventListener("click", () => {
      // keep the first AI greeting, clear everything else
      const first = chat.querySelector(".msg.ai");
      chat.innerHTML = "";
      if(first) chat.appendChild(first);
      latestDraft = "";
      toast("Cleared.");
    });

    /* ---------------- UTILITIES ---------------- */
    function copyText(text){
      if(navigator.clipboard && navigator.clipboard.writeText){
        navigator.clipboard.writeText(text).catch(() => fallbackCopy(text));
      }else{
        fallbackCopy(text);
      }
    }
    function fallbackCopy(text){
      const ta = document.createElement("textarea");
      ta.value = text;
      ta.style.position = "fixed";
      ta.style.left = "-9999px";
      document.body.appendChild(ta);
      ta.select();
      try{ document.execCommand("copy"); }catch(e){}
      document.body.removeChild(ta);
    }

    // simple toast
    let toastTimer = null;
    function toast(message){
      let el = document.getElementById("toast");
      if(!el){
        el = document.createElement("div");
        el.id = "toast";
        el.style.position = "fixed";
        el.style.bottom = "18px";
        el.style.left = "50%";
        el.style.transform = "translateX(-50%)";
        el.style.background = "#0f172a";
        el.style.color = "#fff";
        el.style.padding = "10px 12px";
        el.style.borderRadius = "12px";
        el.style.fontWeight = "900";
        el.style.fontSize = "13px";
        el.style.boxShadow = "0 14px 30px rgba(0,0,0,.20)";
        el.style.zIndex = "999999";
        el.style.maxWidth = "92vw";
        el.style.textAlign = "center";
        el.style.opacity = "0";
        el.style.transition = "opacity .15s ease";
        document.body.appendChild(el);
      }
      el.textContent = message;
      el.style.opacity = "1";
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => { el.style.opacity = "0"; }, 1400);
    }

    // initial render
    render();
  </script>

</body>
</html>
