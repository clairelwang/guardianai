<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Report a Scam</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --text:#0f172a; --muted:#64748b;
      --border:#e5e7eb; --shadow: 0 10px 30px rgba(15,23,42,.08);
      --teal:#0ea5b7; --btn:#7ec7d7; --btnText:#ffffff;
      --radius:16px;
      --danger:#ef4444; --ok:#16a34a;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--text); }

    /* mini bar */
    .miniBar{
      position: fixed; top: 18px; left: 18px; z-index: 9999;
      display:flex; align-items:center; gap:10px;
      background:#fff; border:1px solid var(--border); border-radius: 12px;
      padding: 8px 10px; box-shadow: 0 10px 20px rgba(15,23,42,.10);
    }
    .miniSelectWrap{ position: relative; width: 175px; }
    .miniSelect{
      width:100%; height:34px; border:2px solid #111827; border-radius: 10px;
      padding: 0 34px 0 12px; font-weight: 600; background:#fff; outline:none;
      appearance:none; -webkit-appearance:none; -moz-appearance:none;
    }
    .miniChevron{ position:absolute; right:10px; top:50%; transform: translateY(-50%); pointer-events:none; width:18px; height:18px; color:#111827; opacity:.9; }
    .miniBtn{
      width: 34px; height: 34px; display:grid; place-items:center;
      border: 2px solid #111827; background:#fff; border-radius: 10px; cursor:pointer;
    }
    .miniBtn svg{ width:18px; height:18px; }
    .miniBtn:hover{ background:#f3f4f6; }

    /* layout */
    .page{ width:min(980px, calc(100% - 40px)); margin:0 auto; padding: 92px 0 90px; }
    .topIcon{
      width:68px; height:68px; margin: 0 auto 12px; border-radius: 18px;
      background: #dff6fb; display:grid; place-items:center;
      box-shadow: 0 10px 24px rgba(14,165,183,.12);
    }
    .topIcon svg{ width: 30px; height: 30px; color: var(--teal); }

    h1{ text-align:center; font-size: 44px; line-height: 1.05; margin: 10px 0 10px; letter-spacing: -0.02em; }
    .subtitle{ text-align:center; color: var(--muted); font-size: 18px; line-height: 1.5; margin: 0 auto 26px; max-width: 720px; }

    .stepper{ display:flex; align-items:center; justify-content:center; gap:14px; margin: 10px auto 34px; }
    .stepDot{
      width: 36px; height: 36px; border-radius: 999px; display:grid; place-items:center;
      font-weight: 800; font-size: 14px; border: 2px solid #e5e7eb; color:#6b7280; background:#f3f4f6;
    }
    .stepDot.active{ border-color: var(--teal); background: var(--teal); color:#fff; }
    .stepLine{ width: 70px; height: 4px; border-radius: 999px; background:#e5e7eb; }

    .card{
      background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
      box-shadow: var(--shadow); padding: 26px; width: min(740px, 100%); margin: 0 auto;
    }
    .cardTitle{ font-size: 18px; font-weight: 800; margin: 0 0 16px; }
    .hint{ margin: 0 0 18px; color: var(--muted); font-weight:600; font-size: 13.5px; line-height:1.5; }

    .typeGrid{ display:grid; grid-template-columns: repeat(3, 1fr); gap: 14px; margin-bottom: 18px; }
    .typeBtn{
      border: 2px solid #e5e7eb; background:#fff; border-radius: 12px;
      padding: 16px 14px; min-height: 72px; cursor:pointer;
      display:flex; align-items:center; gap: 10px; text-align:left;
      transition: border-color .2s ease, box-shadow .2s ease, transform .05s ease;
    }
    .typeBtn:hover{ box-shadow: 0 10px 18px rgba(15,23,42,.08); transform: translateY(-1px); }
    .typeBtn.selected{ border-color: #9ca3af; box-shadow: 0 10px 18px rgba(15,23,42,.08); }

    .typeIcon{
      width: 34px; height: 34px; border-radius: 10px; display:grid; place-items:center;
      color:#9ca3af; background:#f8fafc; border: 1px solid #e5e7eb; flex: 0 0 auto;
    }
    .typeIcon svg{ width:18px; height:18px; }
    .typeLabel{ font-weight: 800; font-size: 13px; color:#0f172a; line-height: 1.1; }

    .row{ display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .row3{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; }
    .field{ display:flex; flex-direction:column; gap: 7px; margin-bottom: 14px; }
    label{ font-weight:800; font-size: 12.5px; color:#0f172a; }
    input, select, textarea{
      width:100%; border:1px solid var(--border); border-radius: 12px; padding: 12px 12px;
      font-family:inherit; font-size: 14px; outline:none; background:#fff;
    }
    textarea{ min-height: 120px; resize: vertical; line-height:1.5; }
    input:focus, select:focus, textarea:focus{ border-color:#9ca3af; box-shadow: 0 0 0 3px rgba(14,165,183,.10); }

    .actions{ display:flex; gap: 12px; margin-top: 12px; flex-wrap:wrap; }
    .btn{
      border:none; border-radius: 12px; padding: 13px 16px; cursor:pointer;
      font-family:inherit; font-weight: 900; font-size: 14px;
      display:inline-flex; align-items:center; justify-content:center; gap: 10px;
      transition: transform .05s ease, filter .15s ease;
    }
    .btn:active{ transform: scale(.99); }
    .btnPrimary{ background: var(--btn); color: var(--btnText); }
    .btnGhost{ background:#fff; color:#111827; border:1px solid var(--border); }
    .btnDanger{ background: var(--danger); color:#fff; }
    .btnOk{ background: var(--ok); color:#fff; }

    .btn:disabled{ opacity:.55; cursor:not-allowed; }

    .divider{ height:1px; background: var(--border); margin: 16px 0; }

    .toast{
      margin-top: 14px; padding: 12px 12px; border-radius: 12px; display:none;
      font-weight: 800; font-size: 13px;
    }
    .toast.ok{ background: #dcfce7; color:#166534; border:1px solid #bbf7d0; }
    .toast.err{ background: #fee2e2; color:#7f1d1d; border:1px solid #fecaca; }

    .reviewBox{
      border:1px solid var(--border); border-radius: 14px; background:#fff; padding: 14px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12.5px; line-height: 1.55; color:#0f172a; white-space: pre-wrap;
    }
    .smallLink{
      color:#1d4ed8; font-weight: 900; text-decoration:none;
    }
    .smallLink:hover{ text-decoration:underline; }

    .hidden{ display:none !important; }

    body.mobileView .page{ width: min(820px, calc(100% - 30px)); padding-top: 84px; }
    @media (max-width: 860px){
      h1{ font-size: 36px; }
      .typeGrid{ grid-template-columns: 1fr; }
      .stepLine{ width: 54px; }
      .row, .row3{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <!-- MINI BAR -->
  <div class="miniBar" aria-label="Page switcher">
    <div class="miniSelectWrap">
      <select id="pageSelect" class="miniSelect" aria-label="Switch page">
        <option value="index.html">Home</option>
        <option value="scamanalyzer.html">ScamAnalyzer</option>
        <option value="courses.html">Courses</option>
        <option value="trustedContacts.html">TrustedContacts</option>
        <option value="alerts.html">Alerts</option>
        <option value="simulator.html">Simulator</option>
        <option value="report.html" selected>Report</option>
      </select>
      <svg class="miniChevron" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>

    <button class="miniBtn" id="mobileBtn" type="button" aria-label="Switch to mobile view" title="Mobile view">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M9 3h6a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="2"/>
        <path d="M11 18h2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>

    <button class="miniBtn" id="refreshBtn" type="button" aria-label="Refresh" title="Refresh">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M20 12a8 8 0 1 1-2.34-5.66" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M20 4v6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>
  <!-- /MINI BAR -->

  <main class="page">
    <div class="topIcon" aria-hidden="true">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M8 3h6l4 4v14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z"
              stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        <path d="M14 3v5h5" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        <path d="M9 13h6M9 17h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </div>

    <h1>Report a Scam</h1>
    <p class="subtitle">
      Fill this out once, then you can submit it to your own intake (email/sheet) and quickly report to official agencies.
    </p>

    <div class="stepper" aria-label="Progress steps">
      <div class="stepDot active" id="dot1" aria-current="step">1</div>
      <div class="stepLine" aria-hidden="true"></div>
      <div class="stepDot" id="dot2">2</div>
      <div class="stepLine" aria-hidden="true"></div>
      <div class="stepDot" id="dot3">3</div>
    </div>

    <!-- STEP 1 -->
    <section class="card" id="step1" aria-label="Report step 1">
      <div class="cardTitle">Step 1 — What type of scam did you experience?</div>
      <p class="hint">Pick one to continue. You can change it later.</p>

      <div class="typeGrid">
        <button class="typeBtn" type="button" data-type="phone">
          <div class="typeIcon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M6.5 3.5 9 5.2c.6.4.8 1.2.4 1.8L8 9c.8 1.6 2.4 3.2 4 4l2-1.4c.6-.4 1.4-.2 1.8.4l1.7 2.5c.4.6.3 1.4-.2 1.9-1 .9-2.4 1.6-3.7 1.6-3.2 0-6.6-2.8-8.9-5.1S3 7.2 3 4c0-1.3.7-2.7 1.6-3.7.5-.5 1.3-.6 1.9-.2Z"
                    stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="typeLabel">Phone Call Scam</div>
        </button>

        <button class="typeBtn" type="button" data-type="email">
          <div class="typeIcon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M4 6h16v12H4V6Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              <path d="m4 7 8 6 8-6" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="typeLabel">Email/Phishing</div>
        </button>

        <button class="typeBtn" type="button" data-type="text">
          <div class="typeIcon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M5 6h14a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H10l-4 3v-3H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z"
                    stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="typeLabel">Text Message Scam</div>
        </button>

        <button class="typeBtn" type="button" data-type="website">
          <div class="typeIcon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M4 5h16v14H4V5Z" stroke="currentColor" stroke-width="2"/>
              <path d="M4 9h16" stroke="currentColor" stroke-width="2"/>
              <path d="M10 19c-1.8-2.2-2.6-4.8-2.6-7S8.2 7.2 10 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M14 19c1.8-2.2 2.6-4.8 2.6-7S15.8 7.2 14 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="typeLabel">Fake Website</div>
        </button>

        <button class="typeBtn" type="button" data-type="social">
          <div class="typeIcon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M9 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke="currentColor" stroke-width="2"/>
              <path d="M22 21v-2a4 4 0 0 0-3-3.87" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="typeLabel">Social Media Scam</div>
        </button>

        <button class="typeBtn" type="button" data-type="other">
          <div class="typeIcon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M12 9v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M12 17h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
              <path d="M10.3 4.3 2.9 18.1A2 2 0 0 0 4.6 21h14.8a2 2 0 0 0 1.7-2.9L13.7 4.3a2 2 0 0 0-3.4 0Z"
                    stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="typeLabel">Other</div>
        </button>
      </div>

      <div class="actions">
        <button class="btn btnPrimary" id="toStep2" type="button" disabled>Continue</button>
        <button class="btn btnGhost" id="clearDraft1" type="button">Clear Draft</button>
      </div>
      <div class="toast" id="toast1"></div>
    </section>

    <!-- STEP 2 -->
    <section class="card hidden" id="step2" aria-label="Report step 2">
      <div class="cardTitle">Step 2 — Scam details</div>
      <p class="hint">Don’t include passwords or full SSNs. Add only what’s needed to identify the scam.</p>

      <div class="row">
        <div class="field">
          <label for="scamType">Scam type</label>
          <input id="scamType" type="text" readonly />
        </div>
        <div class="field">
          <label for="dateHappened">Date happened</label>
          <input id="dateHappened" type="date" />
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="contact">Scammer contact (phone/email/username)</label>
          <input id="contact" type="text" placeholder="Example: +1 (555) 123-4567 or name@email.com" />
        </div>
        <div class="field">
          <label for="link">Link/website used (if any)</label>
          <input id="link" type="url" placeholder="https://..." />
        </div>
      </div>

      <div class="row3">
        <div class="field">
          <label for="moneyLost">Money lost (USD)</label>
          <input id="moneyLost" type="number" min="0" step="0.01" placeholder="0" />
        </div>
        <div class="field">
          <label for="paymentMethod">Payment method</label>
          <select id="paymentMethod">
            <option value="">Select...</option>
            <option>Gift cards</option>
            <option>Bank transfer / wire</option>
            <option>Crypto</option>
            <option>Credit / debit card</option>
            <option>Cash app / P2P (Zelle, Venmo, Cash App)</option>
            <option>Cash</option>
            <option>Other</option>
          </select>
        </div>
        <div class="field">
          <label for="state">State (optional)</label>
          <input id="state" type="text" placeholder="TX" />
        </div>
      </div>

      <div class="field">
        <label for="summary">What happened? (short but specific)</label>
        <textarea id="summary" placeholder="Describe what they claimed, what they asked for, and what you did."></textarea>
      </div>

      <div class="actions">
        <button class="btn btnGhost" id="backTo1" type="button">Back</button>
        <button class="btn btnPrimary" id="toStep3" type="button">Continue</button>
        <button class="btn btnGhost" id="saveDraft2" type="button">Save Draft</button>
      </div>
      <div class="toast" id="toast2"></div>
    </section>

    <!-- STEP 3 -->
    <section class="card hidden" id="step3" aria-label="Report step 3">
      <div class="cardTitle">Step 3 — Review & report</div>
      <p class="hint">
        Use “Submit” to send this report to <b>your own intake</b> (Formspree/Google Sheet). Then use the official buttons to report to FTC/IC3.
      </p>

      <div class="reviewBox" id="reviewBox"></div>

      <div class="divider"></div>

      <div class="actions">
        <button class="btn btnGhost" id="backTo2" type="button">Back</button>
        <button class="btn btnOk" id="copyBtn" type="button">Copy Report</button>
        <button class="btn btnPrimary" id="submitBtn" type="button">Submit</button>
        <button class="btn btnDanger" id="clearAll" type="button">Clear</button>
      </div>

      <div class="divider"></div>

      <div class="actions">
        <button class="btn btnGhost" id="openFTC" type="button">Open FTC Report</button>
        <button class="btn btnGhost" id="openIC3" type="button">Open FBI IC3</button>
      </div>

      <p class="hint" style="margin-top:12px;">
        FTC: <a class="smallLink" href="https://reportfraud.ftc.gov/" target="_blank" rel="noopener">reportfraud.ftc.gov</a> |
        IC3: <a class="smallLink" href="https://www.ic3.gov/" target="_blank" rel="noopener">ic3.gov</a>
      </p>

      <div class="toast" id="toast3"></div>
    </section>
  </main>

  <script>
    /**************
     * IMPORTANT: To make "Submit" actually send somewhere, set FORM_ENDPOINT.
     * Option A (Formspree): https://formspree.io/
     *   Example: const FORM_ENDPOINT = "https://formspree.io/f/xxxxxx";
     * Option B (Google Apps Script Web App): you'll paste that URL here.
     **************/
    const FORM_ENDPOINT = ""; // <-- put your endpoint here to make Submit реально send

    // mini bar
    const pageSelect = document.getElementById('pageSelect');
    const mobileBtn = document.getElementById('mobileBtn');
    const refreshBtn = document.getElementById('refreshBtn');
    pageSelect.addEventListener('change', () => window.location.href = pageSelect.value);
    refreshBtn.addEventListener('click', () => window.location.reload());
    mobileBtn.addEventListener('click', () => document.body.classList.toggle('mobileView'));

    // steps + dots
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const dot1 = document.getElementById('dot1');
    const dot2 = document.getElementById('dot2');
    const dot3 = document.getElementById('dot3');

    function setStep(n){
      step1.classList.toggle('hidden', n !== 1);
      step2.classList.toggle('hidden', n !== 2);
      step3.classList.toggle('hidden', n !== 3);

      dot1.classList.toggle('active', n === 1);
      dot2.classList.toggle('active', n === 2);
      dot3.classList.toggle('active', n === 3);

      if(n === 3) buildReview();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // toasts
    function showToast(id, msg, ok=true){
      const el = document.getElementById(id);
      el.textContent = msg;
      el.className = "toast " + (ok ? "ok" : "err");
      el.style.display = "block";
      clearTimeout(el._t);
      el._t = setTimeout(() => { el.style.display = "none"; }, 2400);
    }

    // storage
    const STORAGE_KEY = "guardian_report_draft_v1";
    function loadDraft(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : null;
      }catch{ return null; }
    }
    function saveDraft(data){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }
    function clearDraft(){
      localStorage.removeItem(STORAGE_KEY);
    }

    // state
    let selectedType = null;

    // step 1 selection
    const typeBtns = document.querySelectorAll('.typeBtn');
    const toStep2Btn = document.getElementById('toStep2');

    function typeLabel(type){
      const map = {
        phone:"Phone Call Scam",
        email:"Email/Phishing",
        text:"Text Message Scam",
        website:"Fake Website",
        social:"Social Media Scam",
        other:"Other"
      };
      return map[type] || "Other";
    }

    typeBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        typeBtns.forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedType = btn.dataset.type;
        toStep2Btn.disabled = false;

        // update step2 field
        document.getElementById('scamType').value = typeLabel(selectedType);

        // autosave minimal draft
        const d = collectData();
        saveDraft(d);
      });
    });

    document.getElementById('clearDraft1').addEventListener('click', () => {
      clearDraft();
      selectedType = null;
      typeBtns.forEach(b => b.classList.remove('selected'));
      toStep2Btn.disabled = true;
      showToast('toast1', 'Draft cleared.');
    });

    toStep2Btn.addEventListener('click', () => {
      if(!selectedType) return;
      setStep(2);
    });

    // step 2 fields
    const fields = {
      scamType: document.getElementById('scamType'),
      dateHappened: document.getElementById('dateHappened'),
      contact: document.getElementById('contact'),
      link: document.getElementById('link'),
      moneyLost: document.getElementById('moneyLost'),
      paymentMethod: document.getElementById('paymentMethod'),
      state: document.getElementById('state'),
      summary: document.getElementById('summary'),
    };

    function collectData(){
      return {
        selectedType,
        scamTypeLabel: fields.scamType.value || (selectedType ? typeLabel(selectedType) : ""),
        dateHappened: fields.dateHappened.value || "",
        contact: fields.contact.value.trim(),
        link: fields.link.value.trim(),
        moneyLost: fields.moneyLost.value || "",
        paymentMethod: fields.paymentMethod.value || "",
        state: fields.state.value.trim(),
        summary: fields.summary.value.trim(),
        createdAt: new Date().toISOString()
      };
    }

    function populateFromDraft(d){
      if(!d) return;

      // type
      if(d.selectedType){
        selectedType = d.selectedType;
        toStep2Btn.disabled = false;
        typeBtns.forEach(b => b.classList.toggle('selected', b.dataset.type === selectedType));
        fields.scamType.value = d.scamTypeLabel || typeLabel(selectedType);
      }

      fields.dateHappened.value = d.dateHappened || "";
      fields.contact.value = d.contact || "";
      fields.link.value = d.link || "";
      fields.moneyLost.value = d.moneyLost || "";
      fields.paymentMethod.value = d.paymentMethod || "";
      fields.state.value = d.state || "";
      fields.summary.value = d.summary || "";
    }

    // autosave on input
    Object.values(fields).forEach(el => {
      el.addEventListener('input', () => saveDraft(collectData()));
      el.addEventListener('change', () => saveDraft(collectData()));
    });

    document.getElementById('saveDraft2').addEventListener('click', () => {
      saveDraft(collectData());
      showToast('toast2', 'Draft saved.');
    });

    document.getElementById('backTo1').addEventListener('click', () => setStep(1));
    document.getElementById('toStep3').addEventListener('click', () => {
      const d = collectData();

      // lightweight validation
      if(!d.summary){
        showToast('toast2', 'Please describe what happened (Summary).', false);
        fields.summary.focus();
        return;
      }
      setStep(3);
    });

    // review box
    function buildReview(){
      const d = collectData();
      const lines = [
        "Guardian Shield — Scam Report",
        "--------------------------------",
        `Type: ${d.scamTypeLabel || "N/A"}`,
        `Date: ${d.dateHappened || "N/A"}`,
        `Contact: ${d.contact || "N/A"}`,
        `Link: ${d.link || "N/A"}`,
        `Money lost (USD): ${d.moneyLost || "N/A"}`,
        `Payment method: ${d.paymentMethod || "N/A"}`,
        `State: ${d.state || "N/A"}`,
        "",
        "Summary:",
        d.summary || "N/A",
        "",
        `Generated: ${new Date().toLocaleString()}`
      ];
      document.getElementById('reviewBox').textContent = lines.join("\n");
    }

    // copy
    document.getElementById('copyBtn').addEventListener('click', async () => {
      const text = document.getElementById('reviewBox').textContent;
      try{
        await navigator.clipboard.writeText(text);
        showToast('toast3', 'Copied to clipboard.');
      }catch{
        showToast('toast3', 'Copy failed — your browser blocked clipboard access.', false);
      }
    });

    // official links
    document.getElementById('openFTC').addEventListener('click', () => {
      window.open("https://reportfraud.ftc.gov/", "_blank", "noopener");
    });
    document.getElementById('openIC3').addEventListener('click', () => {
      window.open("https://www.ic3.gov/", "_blank", "noopener");
    });

    // submit to your endpoint
    document.getElementById('submitBtn').addEventListener('click', async () => {
      const d = collectData();

      if(!FORM_ENDPOINT){
        showToast('toast3', 'Add your FORM_ENDPOINT in the code to make Submit.', false);
        return;
      }

      const payload = {
        ...d,
        userAgent: navigator.userAgent,
        page: location.href
      };

      try{
        const res = await fetch(FORM_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if(!res.ok) throw new Error("Non-200 response");

        showToast('toast3', 'Submitted successfully.');
        saveDraft(payload); // keep it saved
      }catch(err){
        showToast('toast3', 'Submit failed. Check your endpoint/CORS settings.', false);
      }
    });

    // clear all
    document.getElementById('clearAll').addEventListener('click', () => {
      clearDraft();
      selectedType = null;
      typeBtns.forEach(b => b.classList.remove('selected'));
      toStep2Btn.disabled = true;

      Object.values(fields).forEach(el => {
        if(el.tagName === "SELECT") el.value = "";
        else el.value = "";
      });

      setStep(1);
      showToast('toast1', 'Cleared.');
    });

    document.getElementById('backTo2').addEventListener('click', () => setStep(2));

    // init from draft
    const draft = loadDraft();
    if(draft){
      populateFromDraft(draft);
      // if they already had a type picked, keep them at step 1 but ready
    }
    // set initial type label if selected later
  </script>
</body>
</html>
