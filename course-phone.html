<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Phone Call Scams – Guardian Shield</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#0f172a;
      --muted:#64748b;
      --line:#e5e7eb;
      --bg:#f8fafc;
      --card:#ffffff;
      --shadow:0 14px 30px rgba(15,23,42,.06);
      --radius:18px;

      --blue:#2563eb;
      --blue-100:#eff6ff;
      --green:#22c55e;
      --green-100:#dcfce7;
      --red:#ef4444;
      --red-100:#fee2e2;
      --amber:#f59e0b;
      --amber-100:#fef3c7;
      --tab:#f1f5f9;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--ink);
    }

    .container{
      width:min(980px, calc(100% - 56px));
      margin:0 auto;
      padding:44px 0 80px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      margin-bottom:18px;
    }
    .back{
      display:inline-flex;
      align-items:center;
      gap:10px;
      color:#334155;
      text-decoration:none;
      font-weight:800;
      font-size:13px;
    }
    .back:hover{ text-decoration:underline; }

    .header{
      display:flex;
      align-items:flex-start;
      gap:14px;
      margin-bottom:12px;
    }
    .icon{
      width:44px;
      height:44px;
      border-radius:14px;
      background:var(--blue);
      display:grid;
      place-items:center;
      color:white;
      flex:0 0 auto;
    }
    .icon svg{ width:22px; height:22px; }

    .titlewrap h1{
      margin:0;
      font-size:22px;
      font-weight:950;
      letter-spacing:-.02em;
      line-height:1.15;
    }
    .titlewrap .sub{
      margin-top:4px;
      color:var(--muted);
      font-weight:750;
      font-size:13px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      border:1px solid rgba(15,23,42,.08);
      background:#f1f5f9;
      color:#0f172a;
      white-space:nowrap;
    }
    .chip.pass{ background:var(--green-100); color:#166534; border-color:rgba(22,101,52,.15); }
    .chip.fail{ background:var(--red-100); color:#991b1b; border-color:rgba(153,27,27,.18); }
    .chip.warn{ background:var(--amber-100); color:#92400e; border-color:rgba(146,64,14,.18); }

    .progress{ margin:14px 0 18px; }
    .bar{
      height:8px;
      border-radius:999px;
      overflow:hidden;
      background:#e5e7eb;
    }
    .fill{
      height:100%;
      width:25%;
      background:#0f172a;
      transition: width .18s ease;
    }

    .tabs{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin:12px 0 18px;
    }
    .tab{
      border:none;
      background:var(--tab);
      color:#334155;
      font-weight:900;
      font-size:13px;
      padding:10px 14px;
      border-radius:999px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition: filter .12s ease, transform .12s ease;
    }
    .tab:hover{ filter:brightness(.98); transform: translateY(-1px); }
    .tab.active{ background:var(--blue); color:white; }
    .tab.done{ background:var(--green-100); color:#166534; }

    .check{
      width:16px; height:16px;
      display:inline-grid;
      place-items:center;
      border-radius:999px;
      background:rgba(34,197,94,.18);
    }
    .tab:not(.done) .check{ display:none; }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:22px;
    }
    .card h2{
      margin:0 0 10px;
      font-size:20px;
      font-weight:950;
      letter-spacing:-.01em;
    }
    .card p{
      margin:0 0 12px;
      color:#334155;
      font-weight:650;
      line-height:1.75;
      font-size:14px;
    }
    .card h3{
      margin:18px 0 10px;
      font-size:14px;
      font-weight:950;
      letter-spacing:-.01em;
    }
    .card ul{
      margin:8px 0 0 18px;
      padding:0;
      color:#334155;
      font-weight:650;
      line-height:1.8;
      font-size:14px;
    }
    .card li{ margin:8px 0; }

    .callout{
      margin-top:14px;
      border:1px solid #e2e8f0;
      background:#f8fafc;
      border-radius:16px;
      padding:12px 14px;
      font-size:13px;
      color:#334155;
      font-weight:750;
      line-height:1.7;
    }
    .callout strong{ color:#0f172a; }

    /* quiz */
    .quiz{
      margin-top:18px;
      border:1px solid #dbeafe;
      background:var(--blue-100);
      border-radius:16px;
      padding:14px;
    }
    .quizHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .quizTitle{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:950;
      color:#1e3a8a;
      font-size:13px;
    }
    .quizTitle .dot{
      width:28px; height:28px;
      border-radius:10px;
      background:var(--blue);
      color:white;
      display:grid;
      place-items:center;
      flex:0 0 auto;
      font-weight:950;
    }
    .quizNote{
      font-size:12px;
      font-weight:850;
      color:#334155;
      background:white;
      border:1px solid #dbeafe;
      padding:6px 10px;
      border-radius:999px;
      white-space:nowrap;
    }

    .q{
      border-top:1px solid rgba(30,58,138,.12);
      padding-top:12px;
      margin-top:12px;
    }
    .q:first-of-type{
      border-top:none;
      padding-top:0;
      margin-top:0;
    }
    .qText{
      font-weight:900;
      color:#0f172a;
      font-size:13px;
      margin:0 0 10px;
      line-height:1.5;
    }
    .opt{
      display:flex;
      align-items:flex-start;
      gap:10px;
      padding:10px 10px;
      border-radius:12px;
      background:rgba(255,255,255,.75);
      border:1px solid rgba(219,234,254,.9);
      margin-bottom:10px;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease;
    }
    .opt:hover{ transform: translateY(-1px); filter:brightness(.99); }
    .opt input{ margin-top:3px; }
    .opt span{
      font-size:13px;
      font-weight:750;
      color:#0f172a;
      line-height:1.45;
    }

    .quizActions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .btn{
      border:none;
      cursor:pointer;
      padding:10px 12px;
      border-radius:12px;
      font-weight:950;
      font-size:13px;
      display:inline-flex;
      align-items:center;
      gap:10px;
    }
    .btn.primary{ background:#0f172a; color:white; }
    .btn.secondary{ background:#f3f4f6; color:#0f172a; border:1px solid #e5e7eb; }
    .btn:disabled{ opacity:.5; cursor:not-allowed; }

    .result{
      margin-top:12px;
      background:white;
      border:1px solid rgba(219,234,254,.9);
      border-radius:12px;
      padding:10px 12px;
      font-weight:900;
      font-size:13px;
      display:none;
    }
    .result.ok{ border-color:rgba(22,101,52,.18); background:#f0fdf4; color:#166534; }
    .result.bad{ border-color:rgba(153,27,27,.18); background:#fef2f2; color:#991b1b; }

    .explain{
      margin-top:10px;
      display:none;
      font-weight:650;
      color:#334155;
      font-size:13px;
      line-height:1.65;
    }
    .explain ul{ margin:8px 0 0 18px; }
    .explain li{ margin:6px 0; }

    /* assistant (non-functional) */
    .assistant{
      margin-top:16px;
      border:1px solid #e0e7ff;
      background:#f5f7ff;
      border-radius:16px;
      padding:14px;
    }
    .assistantHead{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:950;
      color:#1e3a8a;
      margin-bottom:10px;
      font-size:13px;
    }
    .assistantHead .badge{
      width:28px; height:28px;
      border-radius:10px;
      background:var(--blue);
      color:white;
      display:grid;
      place-items:center;
      flex:0 0 auto;
      font-weight:950;
    }
    .assistantBtn{
      border:1px solid #e0e7ff;
      background:white;
      color:#1d4ed8;
      padding:10px 12px;
      border-radius:12px;
      font-weight:950;
      font-size:13px;
      ;
      display:inline-flex;
      align-items:center;
      gap:10px;
      opacity:.95;
    }
    .assistantBtn svg{ width:18px; height:18px; }

    .navrow{
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-top:16px;
    }
    .navbtn{
      border:none;
      cursor:pointer;
      padding:10px 12px;
      border-radius:12px;
      font-weight:950;
      font-size:13px;
      background:#0f172a;
      color:white;
      display:inline-flex;
      align-items:center;
      gap:10px;
    }
    .navbtn.secondary{
      background:#f3f4f6;
      color:#0f172a;
      border:1px solid #e5e7eb;
    }
    .navbtn:disabled{ opacity:.5; cursor:not-allowed; }

    /* final exam modal */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .modal{
      width:min(860px, 100%);
      background:white;
      border-radius:18px;
      border:1px solid rgba(15,23,42,.10);
      box-shadow:0 30px 70px rgba(15,23,42,.25);
      overflow:hidden;
    }
    .modalHead{
      padding:16px 18px;
      border-bottom:1px solid #e5e7eb;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      background:#f8fafc;
    }
    .modalHead h2{
      margin:0;
      font-size:16px;
      font-weight:950;
      letter-spacing:-.01em;
    }
    .modalHead p{
      margin:6px 0 0;
      color:#64748b;
      font-weight:700;
      font-size:13px;
      line-height:1.55;
      max-width:640px;
    }
    .closeBtn{
      border:none;
      background:#eef2f7;
      color:#0f172a;
      border-radius:12px;
      padding:10px 12px;
      font-weight:950;
      cursor:pointer;
      flex:0 0 auto;
    }
    .closeBtn:hover{ filter:brightness(.98); }

    .modalBody{
      padding:16px 18px 18px;
      max-height:min(70vh, 560px);
      overflow:auto;
    }
    .scoreRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }
    .scorePill{
      padding:8px 12px;
      border-radius:999px;
      font-size:12px;
      font-weight:950;
      border:1px solid rgba(15,23,42,.08);
      background:#f1f5f9;
      color:#0f172a;
      white-space:nowrap;
    }
    .scorePill.pass{ background:var(--green-100); color:#166534; border-color:rgba(22,101,52,.15); }
    .scorePill.fail{ background:var(--red-100); color:#991b1b; border-color:rgba(153,27,27,.18); }

    .modalActions{
      padding:14px 18px;
      border-top:1px solid #e5e7eb;
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      background:#fff;
    }

    @media (max-width: 560px){
      .container{ width:calc(100% - 28px); padding-top:26px; }
      .card{ padding:18px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="topbar">
      <a class="back" href="courses.html">
        <span aria-hidden="true">←</span>
        <span>Back to Courses</span>
      </a>
    </div>

    <div class="header">
      <div class="icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M7 8c0-2.2 1.8-4 4-4h2c2.2 0 4 1.8 4 4v8c0 2.2-1.8 4-4 4h-2c-2.2 0-4-1.8-4-4V8z" stroke="white" stroke-width="2"/>
          <path d="M10 7h4" stroke="white" stroke-width="2" stroke-linecap="round"/>
          <path d="M10 17h4" stroke="white" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>

      <div class="titlewrap">
        <h1>Phone Call Scams</h1>
        <div class="sub">
          <span id="lessonCounter">Lesson 1 of 4</span>
          <span class="chip warn" id="courseStatus">Not completed</span>
          <span class="chip" id="courseScore">Course score: —</span>
        </div>
      </div>
    </div>

    <div class="progress">
      <div class="bar"><div class="fill" id="progressFill"></div></div>
    </div>

    <div class="tabs" role="tablist" aria-label="Lessons">
      <button class="tab active" role="tab" aria-selected="true" data-lesson="1">Lesson 1</button>
      <button class="tab" role="tab" aria-selected="false" data-lesson="2"><span class="check" aria-hidden="true">✓</span> Lesson 2</button>
      <button class="tab" role="tab" aria-selected="false" data-lesson="3">Lesson 3</button>
      <button class="tab" role="tab" aria-selected="false" data-lesson="4"><span class="check" aria-hidden="true">✓</span> Lesson 4</button>
    </div>

    <div class="card" id="lessonCard"></div>

    <div class="navrow">
      <button class="navbtn secondary" id="prevBtn" type="button">Previous</button>
      <button class="navbtn" id="nextBtn" type="button">Next</button>
    </div>
  </div>

  <!-- FINAL EXAM MODAL -->
  <div class="overlay" id="examOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="examTitle">
      <div class="modalHead">
        <div>
          <h2 id="examTitle">Final Course Exam (Pass ≥ 80%)</h2>
          <p>
            This is the full course assessment. You need at least <strong>80%</strong> to successfully complete this course.
            You can retake the exam as many times as you want.
          </p>
        </div>
        <button class="closeBtn" id="closeExamBtn" type="button">Close</button>
      </div>

      <div class="modalBody">
        <div class="scoreRow">
          <span class="scorePill" id="examScorePill">Score: —</span>
          <span class="scorePill" id="examPassPill">Status: Not graded</span>
        </div>

        <div id="examQuestions"></div>

        <div class="result" id="examResult"></div>
        <div class="explain" id="examExplain"></div>
      </div>

      <div class="modalActions">
        <button class="btn secondary" id="retakeExamBtn" type="button">Retake Exam</button>
        <button class="btn primary" id="submitExamBtn" type="button">Submit Exam</button>
      </div>
    </div>
  </div>

  <script>
    // ===================== LESSON DATA =====================
    const lessons = [
      {
        title: "How Phone Call Scams Work",
        body: `
          <p>
            Phone scams work because scammers can sound confident, urgent, and “official.”
            They often impersonate trusted organizations (bank, Medicare, IRS) or someone you love (grandchild, spouse).
          </p>

          <h3>The Scam Pattern:</h3>
          <ul>
            <li><strong>Hook:</strong> Something scary or urgent (“fraud,” “arrest,” “computer hacked”).</li>
            <li><strong>Authority:</strong> They claim a title (“agent,” “fraud department,” “officer”).</li>
            <li><strong>Pressure:</strong> “Act now,” “don’t hang up,” “don’t tell anyone.”</li>
            <li><strong>Risky action:</strong> Money transfer, gift cards, or verification codes.</li>
          </ul>

          <div class="callout">
            <strong>Key rule:</strong> Real companies will allow you to hang up and call back using the official number.
            Scammers try to keep you on the line so you can’t verify.
          </div>
        `,
        quiz: {
          minPercentToPass: 80,
          questions: [
            {
              q: "Which combination is the strongest phone scam warning sign?",
              options: [
                "They encourage you to call back and verify",
                "Urgency + threats + refusing to let you hang up",
                "They send you a written letter in the mail",
                "They ask you to write down a reference number"
              ],
              answerIndex: 1,
              explain: "Scammers use urgency/threats and try to prevent verification by keeping you on the phone."
            },
            {
              q: "What is the safest first response to a suspicious caller?",
              options: [
                "Argue until they admit it’s fake",
                "Stay on the call to gather details",
                "Hang up and call the official number yourself",
                "Send a small payment to stop the threats"
              ],
              answerIndex: 2,
              explain: "Independent call-back using an official number is the safest first move."
            },
            {
              q: "Why do scammers say 'don’t tell anyone'?",
              options: [
                "To protect your privacy",
                "To stop you from asking a trusted person for help",
                "To reduce background noise",
                "To help your phone battery last longer"
              ],
              answerIndex: 1,
              explain: "Secrecy is used to isolate you and prevent reality checks."
            }
          ]
        }
      },
      {
        title: "Common Caller Scripts (IRS, Medicare, Bank, Tech Support)",
        body: `
          <p>
            Scammers reuse the same scripts because they work. If you recognize the script, you can shut it down fast.
          </p>

          <h3>IRS / Government Threat Script:</h3>
          <ul>
            <li>“You owe taxes. If you don’t pay today, you’ll be arrested.”</li>
            <li>“A warrant has been issued. Stay on the line.”</li>
          </ul>

          <h3>Medicare / Insurance Script:</h3>
          <ul>
            <li>“We need to confirm your Medicare number.”</li>
            <li>“We can send you free equipment if you verify details.”</li>
          </ul>

          <h3>Bank / Fraud Department Script:</h3>
          <ul>
            <li>“We detected fraud. Read the code we text you to verify your account.”</li>
            <li>“Move your money to a ‘safe account’ right now.”</li>
          </ul>

          <h3>Tech Support Script:</h3>
          <ul>
            <li>“Your computer has a virus. Install this remote access tool so we can fix it.”</li>
          </ul>

          <div class="callout">
            <strong>Red flag payments:</strong> gift cards, wire transfers, crypto, or “safe accounts.”
            Real organizations do not demand these.
          </div>
        `,
        quiz: {
          minPercentToPass: 80,
          questions: [
            {
              q: "A caller claims to be your bank and asks you to read a texted verification code. What should you do?",
              options: [
                "Read the code so they can secure your account",
                "Hang up and call the bank using the number on your card",
                "Stay on the call and ask them to repeat the code",
                "Send a gift card instead"
              ],
              answerIndex: 1,
              explain: "Verification codes are for you. Banks don’t need you to read them. Call back using the number on your card."
            },
            {
              q: "Which request is a huge red flag?",
              options: [
                "They say you may call back on the official number",
                "They ask you to take your time and verify",
                "They demand payment with gift cards to avoid arrest",
                "They send you a statement by mail"
              ],
              answerIndex: 2,
              explain: "Gift cards as payment for legal issues is a classic scam."
            },
            {
              q: "Why is remote access a risk in tech support scams?",
              options: [
                "It improves your Wi-Fi speed",
                "It lets the scammer control your device and access accounts",
                "It reduces scam calls",
                "It blocks your phone number"
              ],
              answerIndex: 1,
              explain: "Remote access can give scammers control of your computer and financial accounts."
            }
          ]
        }
      },
      {
        title: "Caller ID Spoofing + Psychological Tricks",
        body: `
          <p>
            Caller ID can be faked. Scammers can make their number look like your bank, your local police, or even a family member.
            This is called <strong>spoofing</strong>.
          </p>

          <h3>Psychological Pressure Tricks:</h3>
          <ul>
            <li><strong>Authority:</strong> “I’m an officer/agent. Follow instructions.”</li>
            <li><strong>Fear:</strong> “Your account will be frozen.” “You’ll be arrested.”</li>
            <li><strong>Urgency:</strong> “Do this in the next 10 minutes.”</li>
            <li><strong>Isolation:</strong> “Do not tell anyone.”</li>
            <li><strong>Confusion:</strong> They talk fast, use jargon, and keep you overwhelmed.</li>
          </ul>

          <div class="callout">
            <strong>Most reliable signal:</strong> If they resist verification (call-back, written notice, official channels),
            treat it as a scam.
          </div>
        `,
        quiz: {
          minPercentToPass: 80,
          questions: [
            {
              q: "What is caller ID spoofing?",
              options: [
                "When a call drops due to weak signal",
                "When a scammer makes their number look like a real organization",
                "When your phone blocks spam calls automatically",
                "When you put someone on speakerphone"
              ],
              answerIndex: 1,
              explain: "Spoofing is faking the displayed number to look legitimate."
            },
            {
              q: "Which tactic is used to stop you from verifying?",
              options: [
                "Encouraging you to hang up and call back",
                "Giving you time to think",
                "Saying 'stay on the phone with me' and 'don’t tell anyone'",
                "Sending a written letter"
              ],
              answerIndex: 2,
              explain: "Keeping you on the call and demanding secrecy blocks verification."
            },
            {
              q: "Even if the number looks real, what should you do if the call is urgent?",
              options: [
                "Trust the caller ID",
                "Hang up and call the official number yourself",
                "Give them your password to prove you’re the owner",
                "Send money to stop the urgency"
              ],
              answerIndex: 1,
              explain: "Caller ID can be faked. Always verify using a trusted number you find yourself."
            }
          ]
        }
      },
      {
        title: "Safe Scripts + What To Do If You Already Responded",
        body: `
          <p>
            You don’t need to “win” the conversation. Your goal is to stop the risk and verify safely.
          </p>

          <h3>Safe Script (Say This):</h3>
          <ul>
            <li><strong>“I’m going to hang up and call the official number back.”</strong></li>
            <li><strong>“I don’t share codes or passwords over the phone.”</strong></li>
            <li><strong>“Please mail me an official notice.”</strong></li>
          </ul>

          <h3>What NEVER to Share on a Call:</h3>
          <ul>
            <li>Passwords, login links, or one-time verification codes</li>
            <li>Remote-access permission (AnyDesk, TeamViewer, etc.)</li>
            <li>Full Social Security number</li>
            <li>Bank login or “security answers”</li>
          </ul>

          <h3>If You Already Shared Info:</h3>
          <ul>
            <li><strong>Hang up</strong> and call your bank/card using the number on your card</li>
            <li>Change passwords on the affected account(s)</li>
            <li>Enable account alerts and 2-factor authentication</li>
            <li>If you installed remote access: disconnect internet + remove the software + run a security scan</li>
          </ul>

          <div class="callout">
            <strong>Bottom line:</strong> Legitimate organizations will respect verification.
            If they threaten, rush, isolate, or demand unusual payments, treat it as a scam.
          </div>
        `,
        quiz: {
          minPercentToPass: 80,
          questions: [
            {
              q: "Which phrase is the best safe script to use?",
              options: [
                "I’ll stay on the line so you can guide me",
                "I’ll send money now, just stop calling",
                "I’m going to hang up and call the official number back",
                "I’ll read you the code so we can finish quickly"
              ],
              answerIndex: 2,
              explain: "Calling back through official channels is the safest script."
            },
            {
              q: "Which item should you NEVER share on a phone call?",
              options: [
                "Your favorite store",
                "A verification code sent to your phone",
                "The day of the week",
                "Your city name"
              ],
              answerIndex: 1,
              explain: "Verification codes are for you, not for the caller."
            },
            {
              q: "If you installed remote access software because of a call, what is a good immediate action?",
              options: [
                "Ignore it; it’s probably fine",
                "Disconnect internet and remove the software, then run a security scan",
                "Send the caller a follow-up message apologizing",
                "Buy gift cards to ‘close the case’"
              ],
              answerIndex: 1,
              explain: "Remote access can give scammers control; remove it and secure your device/accounts."
            }
          ]
        }
      }
    ];

    // FINAL EXAM
    const finalExam = {
      passPercent: 80,
      questions: [
        {
          q: "A caller claims you owe taxes and will be arrested today unless you pay immediately. Best response?",
          options: [
            "Pay quickly to avoid trouble",
            "Hang up and verify through official channels (IRS/letter/official number)",
            "Stay on the phone and argue",
            "Give them your SSN to confirm"
          ],
          answerIndex: 1,
          explain: "Threats + urgency is a scam pattern. Verify independently using official channels."
        },
        {
          q: "Caller ID shows your bank’s number, but they demand you read a text code. What should you do?",
          options: [
            "Read the code",
            "Hang up and call the bank using the number on your card",
            "Send gift cards instead",
            "Install remote access so they can fix it"
          ],
          answerIndex: 1,
          explain: "Caller ID can be spoofed. Call back using a trusted number you already have (card/statement)."
        },
        {
          q: "Which payment method is a major scam red flag?",
          options: [
            "Normal monthly bill payment",
            "Gift cards or crypto to ‘fix’ an urgent issue",
            "Paying at a physical store checkout",
            "Paying a known utility company by check"
          ],
          answerIndex: 1,
          explain: "Gift cards/crypto are common scam payments because they’re hard to reverse/trace."
        },
        {
          q: "What is caller ID spoofing?",
          options: [
            "When a call drops",
            "When a caller fakes the displayed number to look legitimate",
            "When your phone blocks a call",
            "When you put someone on speaker"
          ],
          answerIndex: 1,
          explain: "Spoofing is faking the displayed number."
        },
        {
          q: "Which phrase is a major red flag?",
          options: [
            "Feel free to hang up and call back",
            "Take your time to verify",
            "Don’t tell anyone and stay on the phone with me",
            "Please contact us through our official website"
          ],
          answerIndex: 2,
          explain: "Secrecy + blocking verification is a classic scam tactic."
        },
        {
          q: "If you accidentally gave personal info on a call, what should you do first?",
          options: [
            "Wait and see",
            "Call your bank/card immediately using the number on your card",
            "Send more info so they stop calling",
            "Post about it online"
          ],
          answerIndex: 1,
          explain: "Immediate contact with your bank/card issuer is critical."
        },
        {
          q: "Why do tech support scammers want remote access?",
          options: [
            "To increase your Wi-Fi speed",
            "To control your device and access accounts",
            "To stop spam calls",
            "To block your phone number"
          ],
          answerIndex: 1,
          explain: "Remote access can let scammers take control and steal money/info."
        },
        {
          q: "What should you NEVER share with a caller claiming to be your bank?",
          options: [
            "Your preferred branch location",
            "A one-time verification code texted to you",
            "The bank’s hours",
            "Your city"
          ],
          answerIndex: 1,
          explain: "Codes are for you to log in—never read them aloud."
        },
        {
          q: "Which is the safest verification method during a suspicious call?",
          options: [
            "Call the number they provide",
            "Click the link they text you",
            "Hang up and call a trusted official number you find yourself",
            "Keep talking until you feel sure"
          ],
          answerIndex: 2,
          explain: "Always verify through independent channels you trust."
        },
        {
          q: "Which safe script is best?",
          options: [
            "I’ll stay on the line so you can guide me",
            "I’m going to hang up and call the official number back",
            "I’ll read the code so we can finish quickly",
            "I’ll send a small payment now"
          ],
          answerIndex: 1,
          explain: "Hanging up and calling back through official numbers is safest."
        }
      ]
    };

    // ===================== STATE =====================
    const KEY = "gs_phone_course_v1";
    const progressFill = document.getElementById("progressFill");
    const lessonCounter = document.getElementById("lessonCounter");
    const lessonCard = document.getElementById("lessonCard");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const tabs = [...document.querySelectorAll(".tab")];

    const courseStatus = document.getElementById("courseStatus");
    const courseScore = document.getElementById("courseScore");

    const examOverlay = document.getElementById("examOverlay");
    const closeExamBtn = document.getElementById("closeExamBtn");
    const submitExamBtn = document.getElementById("submitExamBtn");
    const retakeExamBtn = document.getElementById("retakeExamBtn");
    const examQuestions = document.getElementById("examQuestions");
    const examResult = document.getElementById("examResult");
    const examExplain = document.getElementById("examExplain");
    const examScorePill = document.getElementById("examScorePill");
    const examPassPill = document.getElementById("examPassPill");

    let state = {
      current: 1,
      doneLessons: [false,false,false,false],
      quizPass: [false,false,false,false],
      quizScores: [null,null,null,null],
      finalExam: { attempts: 0, bestPercent: null, passed: false }
    };

    function loadState(){
      try{
        const saved = JSON.parse(localStorage.getItem(KEY));
        if(saved) state = saved;
      }catch(e){}
      state.current = clampNum(state.current, 1, 4);
      state.doneLessons = normBoolArr(state.doneLessons, 4);
      state.quizPass = normBoolArr(state.quizPass, 4);
      state.quizScores = normScoreArr(state.quizScores, 4);
      if(!state.finalExam) state.finalExam = { attempts: 0, bestPercent: null, passed: false };
      if(typeof state.finalExam.attempts !== "number") state.finalExam.attempts = 0;
      if(typeof state.finalExam.passed !== "boolean") state.finalExam.passed = false;
    }
    function saveState(){ localStorage.setItem(KEY, JSON.stringify(state)); }

    function clampNum(n, lo, hi){
      n = Number(n);
      if(Number.isNaN(n)) return lo;
      return Math.max(lo, Math.min(hi, n));
    }
    function normBoolArr(arr, len){
      if(!Array.isArray(arr) || arr.length !== len) return Array(len).fill(false);
      return arr.map(Boolean);
    }
    function normScoreArr(arr, len){
      if(!Array.isArray(arr) || arr.length !== len) return Array(len).fill(null);
      return arr.map(v => (typeof v === "number" ? v : null));
    }

    // ===================== RENDER =====================
    function renderTopStatus(){
      if(state.finalExam.passed){
        courseStatus.textContent = "Completed";
        courseStatus.className = "chip pass";
      }else{
        const allLessonQuizzesPassed = state.quizPass.every(Boolean);
        courseStatus.textContent = allLessonQuizzesPassed ? "Ready for Final Exam" : "Not completed";
        courseStatus.className = "chip warn";
      }

      const best = state.finalExam.bestPercent;
      courseScore.textContent = (typeof best === "number")
        ? `Course score: ${best}%`
        : "Course score: —";
    }

    function lessonPercentComplete(){
      return Math.round((state.current / 4) * 100);
    }

    function renderLesson(n){
      const idx = n - 1;
      const data = lessons[idx];

      lessonCounter.textContent = `Lesson ${n} of 4`;
      progressFill.style.width = lessonPercentComplete() + "%";

      tabs.forEach(t => {
        const ln = Number(t.dataset.lesson);
        t.classList.remove("active");
        t.setAttribute("aria-selected", "false");

        if(state.doneLessons[ln - 1] && state.quizPass[ln - 1]){
          t.classList.add("done");
        }else{
          t.classList.remove("done");
        }

        if(ln === n){
          t.classList.add("active");
          t.setAttribute("aria-selected", "true");
        }
      });

      lessonCard.innerHTML = `
        <h2>${data.title}</h2>
        ${data.body}
        ${renderLessonQuiz(n)}
        
      `;

      attachLessonQuizHandlers(n);

      prevBtn.disabled = (n === 1);
      nextBtn.textContent = (n === 4) ? "Finish Lesson 4" : "Next";

      const passed = !!state.quizPass[idx];
      nextBtn.disabled = !passed;

      renderTopStatus();
    }



    function renderLessonQuiz(lessonNumber){
      const idx = lessonNumber - 1;
      const qz = lessons[idx].quiz;
      const prevScore = state.quizScores[idx];
      const passed = state.quizPass[idx];

      const statusText = passed
        ? `Passed (${prevScore}% ≥ ${qz.minPercentToPass}%)`
        : (typeof prevScore === "number"
            ? `Not passed (${prevScore}% — need ${qz.minPercentToPass}%)`
            : `You must score at least ${qz.minPercentToPass}% to continue`);

      const statusChipClass = passed ? "chip pass" : (typeof prevScore === "number" ? "chip fail" : "chip warn");

      const qs = qz.questions.map((item, qi) => {
        const name = `l${lessonNumber}_q${qi}`;
        const opts = item.options.map((opt, oi) => {
          const id = `${name}_opt${oi}`;
          return `
            <label class="opt" for="${id}">
              <input type="radio" id="${id}" name="${name}" value="${oi}">
              <span>${escapeHtml(opt)}</span>
            </label>
          `;
        }).join("");

        return `
          <div class="q" data-qi="${qi}">
            <div class="qText">${qi + 1}. ${escapeHtml(item.q)}</div>
            ${opts}
          </div>
        `;
      }).join("");

      return `
        <div class="quiz" id="lessonQuiz">
          <div class="quizHead">
            <div class="quizTitle">
              <div class="dot">Q</div>
              <span>Lesson ${lessonNumber} Checkpoint Quiz</span>
            </div>
            <span class="quizNote ${statusChipClass}" id="lessonQuizNote">${statusText}</span>
          </div>

          ${qs}

          <div class="quizActions">
            <button class="btn secondary" id="resetLessonQuizBtn" type="button">Reset</button>
            <button class="btn primary" id="submitLessonQuizBtn" type="button">Submit Quiz</button>
          </div>

          <div class="result" id="lessonQuizResult"></div>
          <div class="explain" id="lessonQuizExplain"></div>
        </div>
      `;
    }

    function attachLessonQuizHandlers(lessonNumber){
      const idx = lessonNumber - 1;
      const qz = lessons[idx].quiz;

      const note = document.getElementById("lessonQuizNote");
      const result = document.getElementById("lessonQuizResult");
      const explain = document.getElementById("lessonQuizExplain");

      const submitBtn = document.getElementById("submitLessonQuizBtn");
      const resetBtn = document.getElementById("resetLessonQuizBtn");

      resetBtn.addEventListener("click", () => {
        qz.questions.forEach((_, qi) => {
          const name = `l${lessonNumber}_q${qi}`;
          document.querySelectorAll(`input[name="${name}"]`).forEach(r => r.checked = false);
        });
        result.style.display = "none";
        explain.style.display = "none";
      });

      submitBtn.addEventListener("click", () => {
        const { percent, correctCount, total, details } = gradeLessonQuiz(lessonNumber);

        state.quizScores[idx] = percent;
        const passed = percent >= qz.minPercentToPass;
        state.quizPass[idx] = passed;
        state.doneLessons[idx] = passed;

        saveState();

        result.style.display = "block";
        result.className = "result " + (passed ? "ok" : "bad");
        result.textContent = passed
          ? `Passed! You scored ${percent}% (${correctCount}/${total}). You can continue.`
          : `Not passed. You scored ${percent}% (${correctCount}/${total}). You need ${qz.minPercentToPass}% to continue.`;

        explain.style.display = "block";
        explain.innerHTML = `
          <div style="font-weight:950; color:#0f172a; margin-bottom:6px;">Answer Review</div>
          <ul>
            ${details.map(d => `
              <li>
                <strong>Q${d.qi+1}:</strong>
                ${d.correct ? '<span style="color:#166534; font-weight:950;">Correct</span>' : '<span style="color:#991b1b; font-weight:950;">Incorrect</span>'}
                — ${escapeHtml(d.explain)}
              </li>
            `).join("")}
          </ul>
        `;

        note.textContent = passed
          ? `Passed (${percent}% ≥ ${qz.minPercentToPass}%)`
          : `Not passed (${percent}% — need ${qz.minPercentToPass}%)`;
        note.className = "quizNote " + (passed ? "chip pass" : "chip fail");

        renderLesson(state.current);
      });
    }

    function gradeLessonQuiz(lessonNumber){
      const idx = lessonNumber - 1;
      const qz = lessons[idx].quiz;

      let correctCount = 0;
      const details = [];

      qz.questions.forEach((item, qi) => {
        const name = `l${lessonNumber}_q${qi}`;
        const selected = document.querySelector(`input[name="${name}"]:checked`);
        const val = selected ? Number(selected.value) : -1;
        const correct = (val === item.answerIndex);
        if(correct) correctCount++;

        details.push({ qi, correct, explain: item.explain });
      });

      const total = qz.questions.length;
      const percent = Math.round((correctCount / total) * 100);
      return { percent, correctCount, total, details };
    }

    // ===================== NAV =====================
    function goTo(n){
      state.current = clampNum(n, 1, 4);
      saveState();
      renderLesson(state.current);
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    tabs.forEach(tab => tab.addEventListener("click", () => goTo(Number(tab.dataset.lesson))));

    prevBtn.addEventListener("click", () => {
      if(state.current > 1) goTo(state.current - 1);
    });

    nextBtn.addEventListener("click", () => {
      const idx = state.current - 1;
      if(!state.quizPass[idx]) return;

      if(state.current < 4){
        goTo(state.current + 1);
        return;
      }
      openExam();
    });

    window.addEventListener("keydown", (e) => {
      if(e.key === "ArrowLeft" && state.current > 1) goTo(state.current - 1);
      if(e.key === "ArrowRight" && state.current < 4){
        const idx = state.current - 1;
        if(state.quizPass[idx]) goTo(state.current + 1);
      }
    });

    // ===================== FINAL EXAM =====================
    function openExam(){
      const ready = state.quizPass.every(Boolean);
      if(!ready){
        alert("You must pass all lesson quizzes before taking the final exam.");
        return;
      }
      renderExamQuestions();
      examOverlay.style.display = "flex";
      examOverlay.setAttribute("aria-hidden", "false");
      examResult.style.display = "none";
      examExplain.style.display = "none";
      updateExamPills(null, null);
    }

    function closeExam(){
      examOverlay.style.display = "none";
      examOverlay.setAttribute("aria-hidden", "true");
      renderTopStatus();
    }

    closeExamBtn.addEventListener("click", closeExam);

    examOverlay.addEventListener("click", (e) => {
      if(e.target === examOverlay) closeExam();
    });

    function renderExamQuestions(){
      examQuestions.innerHTML = finalExam.questions.map((item, qi) => {
        const name = `exam_q${qi}`;
        const opts = item.options.map((opt, oi) => {
          const id = `${name}_opt${oi}`;
          return `
            <label class="opt" for="${id}">
              <input type="radio" id="${id}" name="${name}" value="${oi}">
              <span>${escapeHtml(opt)}</span>
            </label>
          `;
        }).join("");

        return `
          <div class="q">
            <div class="qText">${qi + 1}. ${escapeHtml(item.q)}</div>
            ${opts}
          </div>
        `;
      }).join("");
    }

    function resetExam(){
      finalExam.questions.forEach((_, qi) => {
        const name = `exam_q${qi}`;
        document.querySelectorAll(`input[name="${name}"]`).forEach(r => r.checked = false);
      });
      examResult.style.display = "none";
      examExplain.style.display = "none";
      updateExamPills(null, null);
    }

    retakeExamBtn.addEventListener("click", resetExam);

    submitExamBtn.addEventListener("click", () => {
      const graded = gradeExam();
      state.finalExam.attempts += 1;

      if(typeof state.finalExam.bestPercent !== "number" || graded.percent > state.finalExam.bestPercent){
        state.finalExam.bestPercent = graded.percent;
      }

      const passed = graded.percent >= finalExam.passPercent;
      state.finalExam.passed = passed;

      saveState();

      examResult.style.display = "block";
      examResult.className = "result " + (passed ? "ok" : "bad");
      examResult.textContent = passed
        ? `Passed! You scored ${graded.percent}% (${graded.correctCount}/${graded.total}). Course completed.`
        : `Not passed. You scored ${graded.percent}% (${graded.correctCount}/${graded.total}). You need ${finalExam.passPercent}% to pass.`;

      examExplain.style.display = "block";
      examExplain.innerHTML = `
        <div style="font-weight:950; color:#0f172a; margin-bottom:6px;">Answer Review</div>
        <ul>
          ${graded.details.map(d => `
            <li>
              <strong>Q${d.qi+1}:</strong>
              ${d.correct ? '<span style="color:#166534; font-weight:950;">Correct</span>' : '<span style="color:#991b1b; font-weight:950;">Incorrect</span>'}
              — ${escapeHtml(d.explain)}
            </li>
          `).join("")}
        </ul>
      `;

      updateExamPills(graded.percent, passed);
      renderTopStatus();

      if(passed){
        setTimeout(() => { window.location.href = "courses.html"; }, 900);
      }
    });

    function gradeExam(){
      let correctCount = 0;
      const details = [];

      finalExam.questions.forEach((item, qi) => {
        const name = `exam_q${qi}`;
        const selected = document.querySelector(`input[name="${name}"]:checked`);
        const val = selected ? Number(selected.value) : -1;
        const correct = (val === item.answerIndex);
        if(correct) correctCount++;
        details.push({ qi, correct, explain: item.explain });
      });

      const total = finalExam.questions.length;
      const percent = Math.round((correctCount / total) * 100);
      return { percent, correctCount, total, details };
    }

    function updateExamPills(percent, passed){
      if(typeof percent !== "number"){
        examScorePill.textContent = "Score: —";
        examScorePill.className = "scorePill";
        examPassPill.textContent = "Status: Not graded";
        examPassPill.className = "scorePill";
        return;
      }

      examScorePill.textContent = `Score: ${percent}%`;
      examScorePill.className = "scorePill " + (passed ? "pass" : "fail");
      examPassPill.textContent = passed ? "Status: Passed" : `Status: Not passed (need ≥ ${finalExam.passPercent}%)`;
      examPassPill.className = "scorePill " + (passed ? "pass" : "fail");
    }

    // ===================== HELPERS =====================
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ===================== INIT =====================
    loadState();
    renderTopStatus();
    renderLesson(state.current);
  </script>
  <script src="shared/assistant.js"></script>
</body>
</html>
